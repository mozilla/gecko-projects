{"version":3,"sources":["webpack:///webpack/bootstrap 95e29fe80842dc799896","webpack:///./system-addon/common/Actions.jsm","webpack:///external \"React\"","webpack:///external \"ReactIntl\"","webpack:///(webpack)/buildin/global.js","webpack:///external \"ReactRedux\"","webpack:///./system-addon/content-src/components/TopSites/TopSitesConstants.js","webpack:///./system-addon/common/Dedupe.jsm","webpack:///./system-addon/common/Reducers.jsm","webpack:///./system-addon/content-src/components/ErrorBoundary/ErrorBoundary.jsx","webpack:///./system-addon/content-src/components/ContextMenu/ContextMenu.jsx","webpack:///./system-addon/content-src/lib/link-menu-options.js","webpack:///./system-addon/content-src/components/LinkMenu/LinkMenu.jsx","webpack:///./system-addon/content-src/components/CollapsibleSection/CollapsibleSection.jsx","webpack:///./system-addon/content-src/components/ComponentPerfTimer/ComponentPerfTimer.jsx","webpack:///./system-addon/common/PerfService.jsm","webpack:///./system-addon/content-src/activity-stream.jsx","webpack:///./system-addon/content-src/lib/snippets.js","webpack:///./system-addon/content-src/components/ConfirmDialog/ConfirmDialog.jsx","webpack:///./system-addon/content-src/components/ManualMigration/ManualMigration.jsx","webpack:///./system-addon/content-src/components/PreferencesPane/PreferencesPane.jsx","webpack:///./system-addon/common/PrerenderData.jsm","webpack:///./system-addon/content-src/components/Search/Search.jsx","webpack:///./system-addon/content-src/components/Base/Base.jsx","webpack:///./system-addon/content-src/lib/constants.js","webpack:///./system-addon/content-src/components/Sections/Sections.jsx","webpack:///./system-addon/content-src/components/Card/types.js","webpack:///./system-addon/content-src/components/Card/Card.jsx","webpack:///./system-addon/content-src/components/Topics/Topics.jsx","webpack:///./system-addon/content-src/components/TopSites/TopSites.jsx","webpack:///./system-addon/content-src/components/TopSites/TopSiteForm.jsx","webpack:///./system-addon/content-src/components/TopSites/TopSite.jsx","webpack:///./system-addon/content-src/lib/detect-user-session-start.js","webpack:///./system-addon/content-src/lib/init-store.js","webpack:///external \"Redux\"","webpack:///external \"ReactDOM\""],"names":["globalImportContext","Window","BACKGROUND_PROCESS","UI_CODE","actionTypes","type","_RouteMessage","action","options","meta","Object","assign","from","to","Error","forEach","o","AlsoToMain","fromTarget","skipLocal","CONTENT_MESSAGE_TYPE","MAIN_MESSAGE_TYPE","OnlyToMain","BroadcastToContent","AlsoToOneContent","target","skipMain","toTarget","OnlyToOneContent","AlsoToPreloaded","PRELOAD_MESSAGE_TYPE","UserEvent","data","TELEMETRY_USER_EVENT","UndesiredEvent","importContext","TELEMETRY_UNDESIRED_EVENT","PerfEvent","TELEMETRY_PERFORMANCE_EVENT","ImpressionStats","TELEMETRY_IMPRESSION_STATS","SetPref","name","value","SET_PREF","WebExtEvent","source","isSendToMain","isBroadcastToContent","isSendToOneContent","isSendToPreloaded","isFromMain","getPortIdOfSender","TOP_SITES_SOURCE","TOP_SITES_CONTEXT_MENU_OPTIONS","MIN_RICH_FAVICON_SIZE","MIN_CORNER_FAVICON_SIZE","Dedupe","constructor","createKey","defaultCreateKey","item","group","groups","globalKeys","Set","result","values","valueMap","Map","key","has","set","push","add","map","m","Array","TOP_SITES_DEFAULT_ROWS","TOP_SITES_MAX_SITES_PER_ROW","dedupe","site","url","INITIAL_STATE","App","initialized","version","Snippets","TopSites","rows","editForm","Prefs","Dialog","visible","Sections","PreferencesPane","prevState","at","INIT","insertPinned","links","pinned","pinnedUrls","link","newLinks","filter","includes","isPinned","pinIndex","val","index","length","splice","hasMatch","newRows","TOP_SITES_UPDATED","TOP_SITES_EDIT","TOP_SITES_CANCEL_EDIT","SCREENSHOT_UPDATED","row","screenshot","PLACES_BOOKMARK_ADDED","bookmarkGuid","bookmarkTitle","dateAdded","bookmarkDateCreated","PLACES_BOOKMARK_REMOVED","newSite","DIALOG_OPEN","DIALOG_CANCEL","DELETE_HISTORY_URL","newValues","PREFS_INITIAL_VALUES","PREF_CHANGED","newState","SECTION_DEREGISTER","section","id","SECTION_REGISTER","order","undefined","findIndex","title","enabled","SECTION_UPDATE","dedupeConfigurations","dedupeConf","dedupedRows","dedupeFrom","reduce","dedupeSectionId","dedupeSection","find","s","SECTION_UPDATE_CARD","card","PLACES_LINKS_DELETED","PLACES_LINK_BLOCKED","SNIPPETS_DATA","SNIPPETS_RESET","SETTINGS_OPEN","SETTINGS_CLOSE","ErrorBoundaryFallback","React","PureComponent","props","windowObj","window","onClick","bind","location","reload","render","defaultClass","className","defaultProps","ErrorBoundary","state","hasError","componentDidCatch","error","info","setState","children","FallbackComponent","hideContext","onUpdate","componentWillMount","componentDidUpdate","prevProps","setTimeout","addEventListener","removeEventListener","componentWillUnmount","option","i","onKeyDown","event","shiftKey","first","last","icon","label","LinkMenuOptions","Separator","RemoveBookmark","ac","DELETE_BOOKMARK_BY_ID","userEvent","AddBookmark","BOOKMARK_URL","OpenInNewWindow","OPEN_NEW_WINDOW","referrer","OpenInPrivateWindow","OPEN_PRIVATE_WINDOW","BlockUrl","eventSource","BLOCK_URL","impression","block","tiles","guid","pos","WebExtDismiss","string_id","WEBEXT_DISMISS","action_position","DeleteUrl","onConfirm","forceBlock","body_string_id","confirm_button_string_id","cancel_button_string_id","PinTopSite","TOP_SITES_PIN","UnpinTopSite","TOP_SITES_UNPIN","SaveToPocket","SAVE_TO_POCKET","pocket","EditTopSite","CheckBookmark","CheckPinTopSite","DEFAULT_SITE_MENU_OPTIONS","getOptions","propOptions","isDefault","intl","formatMessage","dispatch","shouldSendImpressionStats","LinkMenu","injectIntl","VISIBLE","VISIBILITY_CHANGE_EVENT","getFormattedMessage","message","getCollapsed","prefName","Info","onInfoEnter","onInfoLeave","onManageClick","infoActive","_setInfoState","nextActive","relatedTarget","currentTarget","compareDocumentPosition","Node","DOCUMENT_POSITION_CONTAINS","infoOption","infoOptionIconA11yAttrs","sectionInfoTitle","header","body","href","InfoIntl","Disclaimer","onAcknowledge","disclaimerPref","disclaimer","text","button","DisclaimerIntl","_CollapsibleSection","onBodyMount","onHeaderClick","onTransitionEnd","enableOrDisableAnimation","enableAnimation","isAnimating","document","componentWillUpdate","nextProps","sectionBody","scrollHeight","visibilityState","node","maxHeight","renderIcon","startsWith","backgroundImage","isCollapsible","isCollapsed","needsDisclaimer","global","CollapsibleSection","RECORDED_SECTIONS","ComponentPerfTimer","Component","perfSvc","_sendBadStateEvent","_sendPaintedEvent","_reportMissingData","_timestampHandled","_recordedFirstRender","componentDidMount","_maybeSendPaintedEvent","_afterFramePaint","callback","requestAnimationFrame","_maybeSendBadStateEvent","_ensureFirstRenderTsRecorded","mark","dataReadyKey","firstRenderKey","parseInt","getMostRecentAbsMarkStartByName","SAVE_SESSION_PERF_DATA","ex","ChromeUtils","import","usablePerfObj","Services","appShell","hiddenDOMWindow","performance","now","_PerfService","performanceObj","_perf","prototype","str","getEntriesByName","timeOrigin","absNow","entries","mostRecentEntry","startTime","store","initStore","gActivityStreamPrerenderedState","sendEventOrAddListener","NEW_TAB_STATE_REQUEST","ReactDOM","hydrate","documentElement","lang","gActivityStreamStrings","getElementById","addSnippetsSubscriber","DATABASE_NAME","DATABASE_VERSION","SNIPPETS_OBJECTSTORE_NAME","SNIPPETS_UPDATE_INTERVAL_MS","SNIPPETS_ENABLED_EVENT","SNIPPETS_DISABLED_EVENT","SnippetsMap","_db","_dispatch","_dbTransaction","db","put","delete","clear","blockList","get","blockSnippetById","SNIPPETS_BLOCKLIST_UPDATED","disableOnboarding","DISABLE_ONBOARDING","showFirefoxAccounts","SHOW_FIREFOX_ACCOUNTS","connect","_openDB","_restoreFromDb","modifier","Promise","resolve","reject","transaction","objectStore","onsuccess","onerror","openRequest","indexedDB","open","deleteDatabase","onupgradeneeded","objectStoreNames","contains","createObjectStore","err","console","onversionchange","versionChangeEvent","close","cursorRequest","openCursor","cursor","continue","SnippetsProvider","gSnippetsMap","_onAction","snippetsMap","_refreshSnippets","cachedVersion","appData","lastUpdate","needsUpdate","Date","snippetsURL","response","fetch","status","payload","e","_noSnippetFallback","_forceOnboardingVisibility","shouldBeVisible","onboardingEl","style","display","_showRemoteSnippets","snippetsEl","elementId","innerHTML","scriptEl","getElementsByTagName","relocatedScript","createElement","parentNode","replaceChild","msg","SNIPPET_BLOCKED","init","addMessageListener","keys","dispatchEvent","Event","uninit","removeMessageListener","snippets","initializing","subscribe","getState","disableSnippets","_handleCancelBtn","_handleConfirmBtn","_renderModalMessage","message_body","ConfirmDialog","onLaunchTour","onCancelTour","MIGRATION_START","MIGRATION_CANCEL","ManualMigration","PreferencesInput","disabled","onChange","labelClassName","titleString","descString","Children","child","handleClickOutside","handlePrefChange","handleSectionChange","togglePane","onWrapperMount","isSidebarOpen","wrapper","checked","SECTION_ENABLE","SECTION_DISABLE","prefs","sections","isVisible","showSearch","showTopSites","topSitesRows","shouldHidePref","pref","feed","nestedPrefs","nestedPref","_PrerenderData","initialPrefs","initialSections","_setValidation","validation","_validation","invalidatingPrefs","_invalidatingPrefs","next","oneOf","concat","arePrefsValid","getPref","some","provider","onInputMount","handleEvent","detail","gContentSearchController","search","input","healthReportKey","IS_NEWTAB","searchSource","ContentSearchUIController","Search","addLocaleDataForReactIntl","locale","addLocaleData","parentLocale","sendNewTabRehydrated","isPrerendered","PAGE_PRERENDERED","renderNotified","NEW_TAB_REHYDRATED","strings","shouldBeFixedToTop","PrerenderData","outerClassName","enableWideLayout","migrationExpired","Base","documentURI","CARDS_PER_ROW","Section","_dispatchImpressionStats","maxCards","maxRows","cards","slice","needsImpressionStats","impressionCardGuids","sendImpressionStatsOrAddListener","_onVisibilityChange","isCollapsedPref","wasCollapsed","numberOfPlaceholders","items","remainder","emptyState","contextMenuOptions","shouldShowTopics","topics","realRows","placeholders","shouldShowEmptyState","padding","isWebExtension","_","read_more_endpoint","SectionIntl","_Sections","cardContextTypes","history","intlID","bookmark","trending","gImageLoading","activeCard","imageLoaded","showContextMenu","onMenuButtonClick","onMenuUpdate","onLinkClick","maybeLoadImage","image","loaderPromise","loader","Image","src","catch","then","preventDefault","altKey","ctrlKey","metaKey","OPEN_LINK","WEBEXT_CLICK","click","componentWillReceiveProps","isContextMenuOpen","hasImage","imageStyle","placeholder","hostname","description","join","context","Card","PlaceholderCard","Topic","Topics","t","countTopSitesIconsTypes","topSites","countTopSitesTypes","acc","tippyTopIcon","faviconRef","tippytop","faviconSize","rich_icon","screenshot_with_icon","no_image","_TopSites","onAddButtonClick","onFormClose","_dispatchTopSitesStats","_getVisibleTopSites","topSitesIconsStats","topSitesPinned","topsites_icon_stats","topsites_pinned","sitesPerRow","matchMedia","matches","TopSitesRows","TopSiteForm","validationError","onLabelChange","onUrlChange","onCancelButtonClick","onDoneButtonClick","onUrlInputMount","resetValidation","ev","onClose","validateForm","cleanUrl","validateUrl","URL","inputUrl","focus","showAsAdd","TopSite","TopSiteLink","onDragEvent","_allowDrop","dataTransfer","types","dragged","effectAllowed","setData","blur","isDraggable","topSiteOuterClassName","isDragged","letterFallback","imageClassName","showSmallFavicon","smallFaviconStyle","smallFaviconFallback","backgroundColor","favicon","draggableProps","onDragEnd","onDragStart","onMouseDown","onActivate","activeIndex","TopSitePlaceholder","onEditButtonClick","_TopSiteList","DEFAULT_STATE","draggedIndex","draggedSite","draggedTitle","topSitesPreview","prevTopSites","newTopSites","dropped","_makeTopSitesPreview","TOP_SITES_INSERT","draggedFromIndex","_getTopSites","pinnedOnly","unpinned","siteToInsert","holeIndex","indexStep","shiftingStep","nextIndex","preview","shift","topSitesUI","commonProps","maxNarrowVisibleIndex","l","slotProps","TopSiteList","DetectUserSessionStart","_store","_perfService","perfService","_sendEvent","visibility_event_rcvd_ts","MERGE_STORE_ACTION","OUTGOING_MESSAGE_NAME","INCOMING_MESSAGE_NAME","EARLY_QUEUED_ACTIONS","mergeStateReducer","mainReducer","messageMiddleware","au","sendAsyncMessage","rehydrationMiddleware","_didRehydrate","isMergeStoreAction","isRehydrationRequest","_didRequestInitialState","queueEarlyMessageMiddleware","_receivedFromMain","_earlyActionQueue","reducers","initialState","createStore","combineReducers","applyMiddleware","dump","JSON","stringify","stack"],"mappings":"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","file":"activity-stream.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 12);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 95e29fe80842dc799896","/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\"use strict\";\n\nthis.MAIN_MESSAGE_TYPE = \"ActivityStream:Main\";\nthis.CONTENT_MESSAGE_TYPE = \"ActivityStream:Content\";\nthis.PRELOAD_MESSAGE_TYPE = \"ActivityStream:PreloadedBrowser\";\nthis.UI_CODE = 1;\nthis.BACKGROUND_PROCESS = 2;\n\n/**\n * globalImportContext - Are we in UI code (i.e. react, a dom) or some kind of background process?\n *                       Use this in action creators if you need different logic\n *                       for ui/background processes.\n */\nconst globalImportContext = typeof Window === \"undefined\" ? BACKGROUND_PROCESS : UI_CODE;\n// Export for tests\nthis.globalImportContext = globalImportContext;\n\n// Create an object that avoids accidental differing key/value pairs:\n// {\n//   INIT: \"INIT\",\n//   UNINIT: \"UNINIT\"\n// }\nconst actionTypes = {};\nfor (const type of [\n  \"BLOCK_URL\",\n  \"BOOKMARK_URL\",\n  \"DELETE_BOOKMARK_BY_ID\",\n  \"DELETE_HISTORY_URL\",\n  \"DELETE_HISTORY_URL_CONFIRM\",\n  \"DIALOG_CANCEL\",\n  \"DIALOG_OPEN\",\n  \"DISABLE_ONBOARDING\",\n  \"INIT\",\n  \"MIGRATION_CANCEL\",\n  \"MIGRATION_COMPLETED\",\n  \"MIGRATION_START\",\n  \"NEW_TAB_INIT\",\n  \"NEW_TAB_INITIAL_STATE\",\n  \"NEW_TAB_LOAD\",\n  \"NEW_TAB_REHYDRATED\",\n  \"NEW_TAB_STATE_REQUEST\",\n  \"NEW_TAB_UNLOAD\",\n  \"OPEN_LINK\",\n  \"OPEN_NEW_WINDOW\",\n  \"OPEN_PRIVATE_WINDOW\",\n  \"PAGE_PRERENDERED\",\n  \"PLACES_BOOKMARK_ADDED\",\n  \"PLACES_BOOKMARK_CHANGED\",\n  \"PLACES_BOOKMARK_REMOVED\",\n  \"PLACES_HISTORY_CLEARED\",\n  \"PLACES_LINKS_DELETED\",\n  \"PLACES_LINK_BLOCKED\",\n  \"PREFS_INITIAL_VALUES\",\n  \"PREF_CHANGED\",\n  \"RICH_ICON_MISSING\",\n  \"SAVE_SESSION_PERF_DATA\",\n  \"SAVE_TO_POCKET\",\n  \"SCREENSHOT_UPDATED\",\n  \"SECTION_DEREGISTER\",\n  \"SECTION_DISABLE\",\n  \"SECTION_ENABLE\",\n  \"SECTION_OPTIONS_CHANGED\",\n  \"SECTION_REGISTER\",\n  \"SECTION_UPDATE\",\n  \"SECTION_UPDATE_CARD\",\n  \"SETTINGS_CLOSE\",\n  \"SETTINGS_OPEN\",\n  \"SET_PREF\",\n  \"SHOW_FIREFOX_ACCOUNTS\",\n  \"SNIPPETS_BLOCKLIST_UPDATED\",\n  \"SNIPPETS_DATA\",\n  \"SNIPPETS_RESET\",\n  \"SNIPPET_BLOCKED\",\n  \"SYSTEM_TICK\",\n  \"TELEMETRY_IMPRESSION_STATS\",\n  \"TELEMETRY_PERFORMANCE_EVENT\",\n  \"TELEMETRY_UNDESIRED_EVENT\",\n  \"TELEMETRY_USER_EVENT\",\n  \"TOP_SITES_CANCEL_EDIT\",\n  \"TOP_SITES_EDIT\",\n  \"TOP_SITES_INSERT\",\n  \"TOP_SITES_PIN\",\n  \"TOP_SITES_UNPIN\",\n  \"TOP_SITES_UPDATED\",\n  \"UNINIT\",\n  \"WEBEXT_CLICK\",\n  \"WEBEXT_DISMISS\"\n]) {\n  actionTypes[type] = type;\n}\n\n// Helper function for creating routed actions between content and main\n// Not intended to be used by consumers\nfunction _RouteMessage(action, options) {\n  const meta = action.meta ? Object.assign({}, action.meta) : {};\n  if (!options || !options.from || !options.to) {\n    throw new Error(\"Routed Messages must have options as the second parameter, and must at least include a .from and .to property.\");\n  }\n  // For each of these fields, if they are passed as an option,\n  // add them to the action. If they are not defined, remove them.\n  [\"from\", \"to\", \"toTarget\", \"fromTarget\", \"skipMain\", \"skipLocal\"].forEach(o => {\n    if (typeof options[o] !== \"undefined\") {\n      meta[o] = options[o];\n    } else if (meta[o]) {\n      delete meta[o];\n    }\n  });\n  return Object.assign({}, action, {meta});\n}\n\n/**\n * AlsoToMain - Creates a message that will be dispatched locally and also sent to the Main process.\n *\n * @param  {object} action Any redux action (required)\n * @param  {object} options\n * @param  {bool}   skipLocal Used by OnlyToMain to skip the main reducer\n * @param  {string} fromTarget The id of the content port from which the action originated. (optional)\n * @return {object} An action with added .meta properties\n */\nfunction AlsoToMain(action, fromTarget, skipLocal) {\n  return _RouteMessage(action, {\n    from: CONTENT_MESSAGE_TYPE,\n    to: MAIN_MESSAGE_TYPE,\n    fromTarget,\n    skipLocal\n  });\n}\n\n/**\n * OnlyToMain - Creates a message that will be sent to the Main process and skip the local reducer.\n *\n * @param  {object} action Any redux action (required)\n * @param  {object} options\n * @param  {string} fromTarget The id of the content port from which the action originated. (optional)\n * @return {object} An action with added .meta properties\n */\nfunction OnlyToMain(action, fromTarget) {\n  return AlsoToMain(action, fromTarget, true);\n}\n\n/**\n * BroadcastToContent - Creates a message that will be dispatched to main and sent to ALL content processes.\n *\n * @param  {object} action Any redux action (required)\n * @return {object} An action with added .meta properties\n */\nfunction BroadcastToContent(action) {\n  return _RouteMessage(action, {\n    from: MAIN_MESSAGE_TYPE,\n    to: CONTENT_MESSAGE_TYPE\n  });\n}\n\n/**\n * AlsoToOneContent - Creates a message that will be will be dispatched to the main store\n *                    and also sent to a particular Content process.\n *\n * @param  {object} action Any redux action (required)\n * @param  {string} target The id of a content port\n * @param  {bool} skipMain Used by OnlyToOneContent to skip the main process\n * @return {object} An action with added .meta properties\n */\nfunction AlsoToOneContent(action, target, skipMain) {\n  if (!target) {\n    throw new Error(\"You must provide a target ID as the second parameter of AlsoToOneContent. If you want to send to all content processes, use BroadcastToContent\");\n  }\n  return _RouteMessage(action, {\n    from: MAIN_MESSAGE_TYPE,\n    to: CONTENT_MESSAGE_TYPE,\n    toTarget: target,\n    skipMain\n  });\n}\n\n/**\n * OnlyToOneContent - Creates a message that will be sent to a particular Content process\n *                    and skip the main reducer.\n *\n * @param  {object} action Any redux action (required)\n * @param  {string} target The id of a content port\n * @return {object} An action with added .meta properties\n */\nfunction OnlyToOneContent(action, target) {\n  return AlsoToOneContent(action, target, true);\n}\n\n/**\n * AlsoToPreloaded - Creates a message that dispatched to the main reducer and also sent to the preloaded tab.\n *\n * @param  {object} action Any redux action (required)\n * @return {object} An action with added .meta properties\n */\nfunction AlsoToPreloaded(action) {\n  return _RouteMessage(action, {\n    from: MAIN_MESSAGE_TYPE,\n    to: PRELOAD_MESSAGE_TYPE\n  });\n}\n\n/**\n * UserEvent - A telemetry ping indicating a user action. This should only\n *                   be sent from the UI during a user session.\n *\n * @param  {object} data Fields to include in the ping (source, etc.)\n * @return {object} An AlsoToMain action\n */\nfunction UserEvent(data) {\n  return AlsoToMain({\n    type: actionTypes.TELEMETRY_USER_EVENT,\n    data\n  });\n}\n\n/**\n * UndesiredEvent - A telemetry ping indicating an undesired state.\n *\n * @param  {object} data Fields to include in the ping (value, etc.)\n * @param  {int} importContext (For testing) Override the import context for testing.\n * @return {object} An action. For UI code, a AlsoToMain action.\n */\nfunction UndesiredEvent(data, importContext = globalImportContext) {\n  const action = {\n    type: actionTypes.TELEMETRY_UNDESIRED_EVENT,\n    data\n  };\n  return importContext === UI_CODE ? AlsoToMain(action) : action;\n}\n\n/**\n * PerfEvent - A telemetry ping indicating a performance-related event.\n *\n * @param  {object} data Fields to include in the ping (value, etc.)\n * @param  {int} importContext (For testing) Override the import context for testing.\n * @return {object} An action. For UI code, a AlsoToMain action.\n */\nfunction PerfEvent(data, importContext = globalImportContext) {\n  const action = {\n    type: actionTypes.TELEMETRY_PERFORMANCE_EVENT,\n    data\n  };\n  return importContext === UI_CODE ? AlsoToMain(action) : action;\n}\n\n/**\n * ImpressionStats - A telemetry ping indicating an impression stats.\n *\n * @param  {object} data Fields to include in the ping\n * @param  {int} importContext (For testing) Override the import context for testing.\n * #return {object} An action. For UI code, a AlsoToMain action.\n */\nfunction ImpressionStats(data, importContext = globalImportContext) {\n  const action = {\n    type: actionTypes.TELEMETRY_IMPRESSION_STATS,\n    data\n  };\n  return importContext === UI_CODE ? AlsoToMain(action) : action;\n}\n\nfunction SetPref(name, value, importContext = globalImportContext) {\n  const action = {type: actionTypes.SET_PREF, data: {name, value}};\n  return importContext === UI_CODE ? AlsoToMain(action) : action;\n}\n\nfunction WebExtEvent(type, data, importContext = globalImportContext) {\n  if (!data || !data.source) {\n    throw new Error(\"WebExtEvent actions should include a property \\\"source\\\", the id of the webextension that should receive the event.\");\n  }\n  const action = {type, data};\n  return importContext === UI_CODE ? AlsoToMain(action) : action;\n}\n\nthis.actionTypes = actionTypes;\n\nthis.actionCreators = {\n  BroadcastToContent,\n  UserEvent,\n  UndesiredEvent,\n  PerfEvent,\n  ImpressionStats,\n  AlsoToOneContent,\n  OnlyToOneContent,\n  AlsoToMain,\n  OnlyToMain,\n  AlsoToPreloaded,\n  SetPref,\n  WebExtEvent\n};\n\n// These are helpers to test for certain kinds of actions\nthis.actionUtils = {\n  isSendToMain(action) {\n    if (!action.meta) {\n      return false;\n    }\n    return action.meta.to === MAIN_MESSAGE_TYPE && action.meta.from === CONTENT_MESSAGE_TYPE;\n  },\n  isBroadcastToContent(action) {\n    if (!action.meta) {\n      return false;\n    }\n    if (action.meta.to === CONTENT_MESSAGE_TYPE && !action.meta.toTarget) {\n      return true;\n    }\n    return false;\n  },\n  isSendToOneContent(action) {\n    if (!action.meta) {\n      return false;\n    }\n    if (action.meta.to === CONTENT_MESSAGE_TYPE && action.meta.toTarget) {\n      return true;\n    }\n    return false;\n  },\n  isSendToPreloaded(action) {\n    if (!action.meta) {\n      return false;\n    }\n    return action.meta.to === PRELOAD_MESSAGE_TYPE &&\n      action.meta.from === MAIN_MESSAGE_TYPE;\n  },\n  isFromMain(action) {\n    if (!action.meta) {\n      return false;\n    }\n    return action.meta.from === MAIN_MESSAGE_TYPE &&\n      action.meta.to === CONTENT_MESSAGE_TYPE;\n  },\n  getPortIdOfSender(action) {\n    return (action.meta && action.meta.fromTarget) || null;\n  },\n  _RouteMessage\n};\n\nthis.EXPORTED_SYMBOLS = [\n  \"actionTypes\",\n  \"actionCreators\",\n  \"actionUtils\",\n  \"globalImportContext\",\n  \"UI_CODE\",\n  \"BACKGROUND_PROCESS\",\n  \"MAIN_MESSAGE_TYPE\",\n  \"CONTENT_MESSAGE_TYPE\",\n  \"PRELOAD_MESSAGE_TYPE\"\n];\n\n\n\n// WEBPACK FOOTER //\n// ./system-addon/common/Actions.jsm","module.exports = React;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"React\"\n// module id = 1\n// module chunks = 0","module.exports = ReactIntl;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"ReactIntl\"\n// module id = 2\n// module chunks = 0","var g;\r\n\r\n// This works in non-strict mode\r\ng = (function() {\r\n\treturn this;\r\n})();\r\n\r\ntry {\r\n\t// This works if eval is allowed (see CSP)\r\n\tg = g || Function(\"return this\")() || (1,eval)(\"this\");\r\n} catch(e) {\r\n\t// This works if the window reference is available\r\n\tif(typeof window === \"object\")\r\n\t\tg = window;\r\n}\r\n\r\n// g can still be undefined, but nothing to do about it...\r\n// We return undefined, instead of nothing here, so it's\r\n// easier to handle this case. if(!global) { ...}\r\n\r\nmodule.exports = g;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// (webpack)/buildin/global.js\n// module id = 3\n// module chunks = 0","module.exports = ReactRedux;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"ReactRedux\"\n// module id = 4\n// module chunks = 0","export const TOP_SITES_SOURCE = \"TOP_SITES\";\nexport const TOP_SITES_CONTEXT_MENU_OPTIONS = [\"CheckPinTopSite\", \"EditTopSite\", \"Separator\",\n  \"OpenInNewWindow\", \"OpenInPrivateWindow\", \"Separator\", \"BlockUrl\", \"DeleteUrl\"];\n// minimum size necessary to show a rich icon instead of a screenshot\nexport const MIN_RICH_FAVICON_SIZE = 96;\n// minimum size necessary to show any icon in the top left corner with a screenshot\nexport const MIN_CORNER_FAVICON_SIZE = 16;\n\n\n\n// WEBPACK FOOTER //\n// ./system-addon/content-src/components/TopSites/TopSitesConstants.js","this.Dedupe = class Dedupe {\n  constructor(createKey) {\n    this.createKey = createKey || this.defaultCreateKey;\n  }\n\n  defaultCreateKey(item) {\n    return item;\n  }\n\n  /**\n   * Dedupe any number of grouped elements favoring those from earlier groups.\n   *\n   * @param {Array} groups Contains an arbitrary number of arrays of elements.\n   * @returns {Array} A matching array of each provided group deduped.\n   */\n  group(...groups) {\n    const globalKeys = new Set();\n    const result = [];\n    for (const values of groups) {\n      const valueMap = new Map();\n      for (const value of values) {\n        const key = this.createKey(value);\n        if (!globalKeys.has(key) && !valueMap.has(key)) {\n          valueMap.set(key, value);\n        }\n      }\n      result.push(valueMap);\n      valueMap.forEach((value, key) => globalKeys.add(key));\n    }\n    return result.map(m => Array.from(m.values()));\n  }\n};\n\nthis.EXPORTED_SYMBOLS = [\"Dedupe\"];\n\n\n\n// WEBPACK FOOTER //\n// ./system-addon/common/Dedupe.jsm","/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\"use strict\";\n\nconst {actionTypes: at} = ChromeUtils.import(\"resource://activity-stream/common/Actions.jsm\", {});\nconst {Dedupe} = ChromeUtils.import(\"resource://activity-stream/common/Dedupe.jsm\", {});\n\nconst TOP_SITES_DEFAULT_ROWS = 1;\nconst TOP_SITES_MAX_SITES_PER_ROW = 8;\n\nconst dedupe = new Dedupe(site => site && site.url);\n\nconst INITIAL_STATE = {\n  App: {\n    // Have we received real data from the app yet?\n    initialized: false,\n    // The version of the system-addon\n    version: null\n  },\n  Snippets: {initialized: false},\n  TopSites: {\n    // Have we received real data from history yet?\n    initialized: false,\n    // The history (and possibly default) links\n    rows: [],\n    // Used in content only to dispatch action to TopSiteForm.\n    editForm: null\n  },\n  Prefs: {\n    initialized: false,\n    values: {}\n  },\n  Dialog: {\n    visible: false,\n    data: {}\n  },\n  Sections: [],\n  PreferencesPane: {visible: false}\n};\n\nfunction App(prevState = INITIAL_STATE.App, action) {\n  switch (action.type) {\n    case at.INIT:\n      return Object.assign({}, prevState, action.data || {}, {initialized: true});\n    default:\n      return prevState;\n  }\n}\n\n/**\n * insertPinned - Inserts pinned links in their specified slots\n *\n * @param {array} a list of links\n * @param {array} a list of pinned links\n * @return {array} resulting list of links with pinned links inserted\n */\nfunction insertPinned(links, pinned) {\n  // Remove any pinned links\n  const pinnedUrls = pinned.map(link => link && link.url);\n  let newLinks = links.filter(link => (link ? !pinnedUrls.includes(link.url) : false));\n  newLinks = newLinks.map(link => {\n    if (link && link.isPinned) {\n      delete link.isPinned;\n      delete link.pinIndex;\n    }\n    return link;\n  });\n\n  // Then insert them in their specified location\n  pinned.forEach((val, index) => {\n    if (!val) { return; }\n    let link = Object.assign({}, val, {isPinned: true, pinIndex: index});\n    if (index > newLinks.length) {\n      newLinks[index] = link;\n    } else {\n      newLinks.splice(index, 0, link);\n    }\n  });\n\n  return newLinks;\n}\n\nfunction TopSites(prevState = INITIAL_STATE.TopSites, action) {\n  let hasMatch;\n  let newRows;\n  switch (action.type) {\n    case at.TOP_SITES_UPDATED:\n      if (!action.data) {\n        return prevState;\n      }\n      return Object.assign({}, prevState, {initialized: true, rows: action.data});\n    case at.TOP_SITES_EDIT:\n      return Object.assign({}, prevState, {editForm: {index: action.data.index}});\n    case at.TOP_SITES_CANCEL_EDIT:\n      return Object.assign({}, prevState, {editForm: null});\n    case at.SCREENSHOT_UPDATED:\n      newRows = prevState.rows.map(row => {\n        if (row && row.url === action.data.url) {\n          hasMatch = true;\n          return Object.assign({}, row, {screenshot: action.data.screenshot});\n        }\n        return row;\n      });\n      return hasMatch ? Object.assign({}, prevState, {rows: newRows}) : prevState;\n    case at.PLACES_BOOKMARK_ADDED:\n      if (!action.data) {\n        return prevState;\n      }\n      newRows = prevState.rows.map(site => {\n        if (site && site.url === action.data.url) {\n          const {bookmarkGuid, bookmarkTitle, dateAdded} = action.data;\n          return Object.assign({}, site, {bookmarkGuid, bookmarkTitle, bookmarkDateCreated: dateAdded});\n        }\n        return site;\n      });\n      return Object.assign({}, prevState, {rows: newRows});\n    case at.PLACES_BOOKMARK_REMOVED:\n      if (!action.data) {\n        return prevState;\n      }\n      newRows = prevState.rows.map(site => {\n        if (site && site.url === action.data.url) {\n          const newSite = Object.assign({}, site);\n          delete newSite.bookmarkGuid;\n          delete newSite.bookmarkTitle;\n          delete newSite.bookmarkDateCreated;\n          return newSite;\n        }\n        return site;\n      });\n      return Object.assign({}, prevState, {rows: newRows});\n    default:\n      return prevState;\n  }\n}\n\nfunction Dialog(prevState = INITIAL_STATE.Dialog, action) {\n  switch (action.type) {\n    case at.DIALOG_OPEN:\n      return Object.assign({}, prevState, {visible: true, data: action.data});\n    case at.DIALOG_CANCEL:\n      return Object.assign({}, prevState, {visible: false});\n    case at.DELETE_HISTORY_URL:\n      return Object.assign({}, INITIAL_STATE.Dialog);\n    default:\n      return prevState;\n  }\n}\n\nfunction Prefs(prevState = INITIAL_STATE.Prefs, action) {\n  let newValues;\n  switch (action.type) {\n    case at.PREFS_INITIAL_VALUES:\n      return Object.assign({}, prevState, {initialized: true, values: action.data});\n    case at.PREF_CHANGED:\n      newValues = Object.assign({}, prevState.values);\n      newValues[action.data.name] = action.data.value;\n      return Object.assign({}, prevState, {values: newValues});\n    default:\n      return prevState;\n  }\n}\n\nfunction Sections(prevState = INITIAL_STATE.Sections, action) {\n  let hasMatch;\n  let newState;\n  switch (action.type) {\n    case at.SECTION_DEREGISTER:\n      return prevState.filter(section => section.id !== action.data);\n    case at.SECTION_REGISTER:\n      // If section exists in prevState, update it\n      newState = prevState.map(section => {\n        if (section && section.id === action.data.id) {\n          hasMatch = true;\n          return Object.assign({}, section, action.data);\n        }\n        return section;\n      });\n\n      // Invariant: Sections array sorted in increasing order of property `order`.\n      // If section doesn't exist in prevState, create a new section object. If\n      // the section has an order, insert it at the correct place in the array.\n      // Otherwise, prepend it and set the order to be minimal.\n      if (!hasMatch) {\n        const initialized = !!(action.data.rows && action.data.rows.length > 0);\n        let order;\n        let index;\n        if (prevState.length > 0) {\n          order = action.data.order !== undefined ? action.data.order : prevState[0].order - 1;\n          index = newState.findIndex(section => section.order >= order);\n          if (index === -1) {\n            index = newState.length;\n          }\n        } else {\n          order = action.data.order !== undefined ? action.data.order : 0;\n          index = 0;\n        }\n\n        const section = Object.assign({title: \"\", rows: [], order, enabled: false}, action.data, {initialized});\n        newState.splice(index, 0, section);\n      }\n      return newState;\n    case at.SECTION_UPDATE:\n      newState = prevState.map(section => {\n        if (section && section.id === action.data.id) {\n          // If the action is updating rows, we should consider initialized to be true.\n          // This can be overridden if initialized is defined in the action.data\n          const initialized = action.data.rows ? {initialized: true} : {};\n          return Object.assign({}, section, initialized, action.data);\n        }\n        return section;\n      });\n\n      if (!action.data.dedupeConfigurations) {\n        return newState;\n      }\n\n      action.data.dedupeConfigurations.forEach(dedupeConf => {\n        newState = newState.map(section => {\n          if (section.id === dedupeConf.id) {\n            const dedupedRows = dedupeConf.dedupeFrom.reduce((rows, dedupeSectionId) => {\n              const dedupeSection = newState.find(s => s.id === dedupeSectionId);\n              const [, newRows] = dedupe.group(dedupeSection.rows, rows);\n              return newRows;\n            }, section.rows);\n\n            return Object.assign({}, section, {rows: dedupedRows});\n          }\n\n          return section;\n        });\n      });\n\n      return newState;\n    case at.SECTION_UPDATE_CARD:\n      return prevState.map(section => {\n        if (section && section.id === action.data.id && section.rows) {\n          const newRows = section.rows.map(card => {\n            if (card.url === action.data.url) {\n              return Object.assign({}, card, action.data.options);\n            }\n            return card;\n          });\n          return Object.assign({}, section, {rows: newRows});\n        }\n        return section;\n      });\n    case at.PLACES_BOOKMARK_ADDED:\n      if (!action.data) {\n        return prevState;\n      }\n      return prevState.map(section => Object.assign({}, section, {\n        rows: section.rows.map(item => {\n          // find the item within the rows that is attempted to be bookmarked\n          if (item.url === action.data.url) {\n            const {bookmarkGuid, bookmarkTitle, dateAdded} = action.data;\n            return Object.assign({}, item, {\n              bookmarkGuid,\n              bookmarkTitle,\n              bookmarkDateCreated: dateAdded,\n              type: \"bookmark\"\n            });\n          }\n          return item;\n        })\n      }));\n    case at.PLACES_BOOKMARK_REMOVED:\n      if (!action.data) {\n        return prevState;\n      }\n      return prevState.map(section => Object.assign({}, section, {\n        rows: section.rows.map(item => {\n          // find the bookmark within the rows that is attempted to be removed\n          if (item.url === action.data.url) {\n            const newSite = Object.assign({}, item);\n            delete newSite.bookmarkGuid;\n            delete newSite.bookmarkTitle;\n            delete newSite.bookmarkDateCreated;\n            if (!newSite.type || newSite.type === \"bookmark\") {\n              newSite.type = \"history\";\n            }\n            return newSite;\n          }\n          return item;\n        })\n      }));\n    case at.PLACES_LINKS_DELETED:\n      return prevState.map(section => Object.assign({}, section,\n        {rows: section.rows.filter(site => !action.data.includes(site.url))}));\n    case at.PLACES_LINK_BLOCKED:\n      return prevState.map(section =>\n        Object.assign({}, section, {rows: section.rows.filter(site => site.url !== action.data.url)}));\n    default:\n      return prevState;\n  }\n}\n\nfunction Snippets(prevState = INITIAL_STATE.Snippets, action) {\n  switch (action.type) {\n    case at.SNIPPETS_DATA:\n      return Object.assign({}, prevState, {initialized: true}, action.data);\n    case at.SNIPPETS_RESET:\n      return INITIAL_STATE.Snippets;\n    default:\n      return prevState;\n  }\n}\n\nfunction PreferencesPane(prevState = INITIAL_STATE.PreferencesPane, action) {\n  switch (action.type) {\n    case at.SETTINGS_OPEN:\n      return Object.assign({}, prevState, {visible: true});\n    case at.SETTINGS_CLOSE:\n      return Object.assign({}, prevState, {visible: false});\n    default:\n      return prevState;\n  }\n}\n\nthis.INITIAL_STATE = INITIAL_STATE;\nthis.TOP_SITES_DEFAULT_ROWS = TOP_SITES_DEFAULT_ROWS;\nthis.TOP_SITES_MAX_SITES_PER_ROW = TOP_SITES_MAX_SITES_PER_ROW;\n\nthis.reducers = {TopSites, App, Snippets, Prefs, Dialog, Sections, PreferencesPane};\nthis.insertPinned = insertPinned;\n\nthis.EXPORTED_SYMBOLS = [\"reducers\", \"INITIAL_STATE\", \"insertPinned\", \"TOP_SITES_DEFAULT_ROWS\", \"TOP_SITES_MAX_SITES_PER_ROW\"];\n\n\n\n// WEBPACK FOOTER //\n// ./system-addon/common/Reducers.jsm","import {FormattedMessage} from \"react-intl\";\nimport React from \"react\";\n\nexport class ErrorBoundaryFallback extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.windowObj = this.props.windowObj || window;\n    this.onClick = this.onClick.bind(this);\n  }\n\n  /**\n   * Since we only get here if part of the page has crashed, do a\n   * forced reload to give us the best chance at recovering.\n   */\n  onClick() {\n    this.windowObj.location.reload(true);\n  }\n\n  render() {\n    const defaultClass = \"as-error-fallback\";\n    let className;\n    if (\"className\" in this.props) {\n      className = `${this.props.className} ${defaultClass}`;\n    } else {\n      className = defaultClass;\n    }\n\n    // href=\"#\" to force normal link styling stuff (eg cursor on hover)\n    return (\n      <div className={className}>\n        <div>\n          <FormattedMessage\n            defaultMessage=\"Oops, something went wrong loading this content.\"\n            id=\"error_fallback_default_info\" />\n        </div>\n        <span>\n          <a href=\"#\" className=\"reload-button\" onClick={this.onClick}>\n            <FormattedMessage\n              defaultMessage=\"Refresh page to try again.\"\n              id=\"error_fallback_default_refresh_suggestion\" />\n          </a>\n        </span>\n      </div>\n    );\n  }\n}\nErrorBoundaryFallback.defaultProps = {className: \"as-error-fallback\"};\n\nexport class ErrorBoundary extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {hasError: false};\n  }\n\n  componentDidCatch(error, info) {\n    this.setState({hasError: true});\n  }\n\n  render() {\n    if (!this.state.hasError) {\n      return (this.props.children);\n    }\n\n    return <this.props.FallbackComponent className={this.props.className} />;\n  }\n}\n\nErrorBoundary.defaultProps = {FallbackComponent: ErrorBoundaryFallback};\n\n\n\n// WEBPACK FOOTER //\n// ./system-addon/content-src/components/ErrorBoundary/ErrorBoundary.jsx","import React from \"react\";\n\nexport class ContextMenu extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.hideContext = this.hideContext.bind(this);\n  }\n\n  hideContext() {\n    this.props.onUpdate(false);\n  }\n\n  componentWillMount() {\n    this.hideContext();\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.props.visible && !prevProps.visible) {\n      setTimeout(() => {\n        window.addEventListener(\"click\", this.hideContext);\n      }, 0);\n    }\n    if (!this.props.visible && prevProps.visible) {\n      window.removeEventListener(\"click\", this.hideContext);\n    }\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener(\"click\", this.hideContext);\n  }\n\n  render() {\n    return (<span hidden={!this.props.visible} className=\"context-menu\">\n      <ul role=\"menu\" className=\"context-menu-list\">\n        {this.props.options.map((option, i) => (option.type === \"separator\" ?\n          (<li key={i} className=\"separator\" />) :\n          (<ContextMenuItem key={i} option={option} hideContext={this.hideContext} />)\n        ))}\n      </ul>\n    </span>);\n  }\n}\n\nexport class ContextMenuItem extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.onClick = this.onClick.bind(this);\n    this.onKeyDown = this.onKeyDown.bind(this);\n  }\n\n  onClick() {\n    this.props.hideContext();\n    this.props.option.onClick();\n  }\n\n  onKeyDown(event) {\n    const {option} = this.props;\n    switch (event.key) {\n      case \"Tab\":\n        // tab goes down in context menu, shift + tab goes up in context menu\n        // if we're on the last item, one more tab will close the context menu\n        // similarly, if we're on the first item, one more shift + tab will close it\n        if ((event.shiftKey && option.first) || (!event.shiftKey && option.last)) {\n          this.props.hideContext();\n        }\n        break;\n      case \"Enter\":\n        this.props.hideContext();\n        option.onClick();\n        break;\n    }\n  }\n\n  render() {\n    const {option} = this.props;\n    return (\n      <li role=\"menuitem\" className=\"context-menu-item\">\n        <a onClick={this.onClick} onKeyDown={this.onKeyDown} tabIndex=\"0\">\n          {option.icon && <span className={`icon icon-spacer icon-${option.icon}`} />}\n          {option.label}\n        </a>\n      </li>);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./system-addon/content-src/components/ContextMenu/ContextMenu.jsx","import {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\n\n/**\n * List of functions that return items that can be included as menu options in a\n * LinkMenu. All functions take the site as the first parameter, and optionally\n * the index of the site.\n */\nexport const LinkMenuOptions = {\n  Separator: () => ({type: \"separator\"}),\n  RemoveBookmark: site => ({\n    id: \"menu_action_remove_bookmark\",\n    icon: \"bookmark-added\",\n    action: ac.AlsoToMain({\n      type: at.DELETE_BOOKMARK_BY_ID,\n      data: site.bookmarkGuid\n    }),\n    userEvent: \"BOOKMARK_DELETE\"\n  }),\n  AddBookmark: site => ({\n    id: \"menu_action_bookmark\",\n    icon: \"bookmark-hollow\",\n    action: ac.AlsoToMain({\n      type: at.BOOKMARK_URL,\n      data: {url: site.url, title: site.title, type: site.type}\n    }),\n    userEvent: \"BOOKMARK_ADD\"\n  }),\n  OpenInNewWindow: site => ({\n    id: \"menu_action_open_new_window\",\n    icon: \"new-window\",\n    action: ac.AlsoToMain({\n      type: at.OPEN_NEW_WINDOW,\n      data: {url: site.url, referrer: site.referrer}\n    }),\n    userEvent: \"OPEN_NEW_WINDOW\"\n  }),\n  OpenInPrivateWindow: site => ({\n    id: \"menu_action_open_private_window\",\n    icon: \"new-window-private\",\n    action: ac.AlsoToMain({\n      type: at.OPEN_PRIVATE_WINDOW,\n      data: {url: site.url, referrer: site.referrer}\n    }),\n    userEvent: \"OPEN_PRIVATE_WINDOW\"\n  }),\n  BlockUrl: (site, index, eventSource) => ({\n    id: \"menu_action_dismiss\",\n    icon: \"dismiss\",\n    action: ac.AlsoToMain({\n      type: at.BLOCK_URL,\n      data: site.url\n    }),\n    impression: ac.ImpressionStats({\n      source: eventSource,\n      block: 0,\n      tiles: [{id: site.guid, pos: index}]\n    }),\n    userEvent: \"BLOCK\"\n  }),\n\n  // This is an option for web extentions which will result in remove items from\n  // memory and notify the web extenion, rather than using the built-in block list.\n  WebExtDismiss: (site, index, eventSource) => ({\n    id: \"menu_action_webext_dismiss\",\n    string_id: \"menu_action_dismiss\",\n    icon: \"dismiss\",\n    action: ac.WebExtEvent(at.WEBEXT_DISMISS, {\n      source: eventSource,\n      url: site.url,\n      action_position: index\n    })\n  }),\n  DeleteUrl: site => ({\n    id: \"menu_action_delete\",\n    icon: \"delete\",\n    action: {\n      type: at.DIALOG_OPEN,\n      data: {\n        onConfirm: [\n          ac.AlsoToMain({type: at.DELETE_HISTORY_URL, data: {url: site.url, forceBlock: site.bookmarkGuid}}),\n          ac.UserEvent({event: \"DELETE\"})\n        ],\n        body_string_id: [\"confirm_history_delete_p1\", \"confirm_history_delete_notice_p2\"],\n        confirm_button_string_id: \"menu_action_delete\",\n        cancel_button_string_id: \"topsites_form_cancel_button\",\n        icon: \"modal-delete\"\n      }\n    },\n    userEvent: \"DIALOG_OPEN\"\n  }),\n  PinTopSite: (site, index) => ({\n    id: \"menu_action_pin\",\n    icon: \"pin\",\n    action: ac.AlsoToMain({\n      type: at.TOP_SITES_PIN,\n      data: {site: {url: site.url}, index}\n    }),\n    userEvent: \"PIN\"\n  }),\n  UnpinTopSite: site => ({\n    id: \"menu_action_unpin\",\n    icon: \"unpin\",\n    action: ac.AlsoToMain({\n      type: at.TOP_SITES_UNPIN,\n      data: {site: {url: site.url}}\n    }),\n    userEvent: \"UNPIN\"\n  }),\n  SaveToPocket: (site, index, eventSource) => ({\n    id: \"menu_action_save_to_pocket\",\n    icon: \"pocket\",\n    action: ac.AlsoToMain({\n      type: at.SAVE_TO_POCKET,\n      data: {site: {url: site.url, title: site.title}}\n    }),\n    impression: ac.ImpressionStats({\n      source: eventSource,\n      pocket: 0,\n      tiles: [{id: site.guid, pos: index}]\n    }),\n    userEvent: \"SAVE_TO_POCKET\"\n  }),\n  EditTopSite: (site, index) => ({\n    id: \"edit_topsites_button_text\",\n    icon: \"edit\",\n    action: {\n      type: at.TOP_SITES_EDIT,\n      data: {index}\n    }\n  }),\n  CheckBookmark: site => (site.bookmarkGuid ? LinkMenuOptions.RemoveBookmark(site) : LinkMenuOptions.AddBookmark(site)),\n  CheckPinTopSite: (site, index) => (site.isPinned ? LinkMenuOptions.UnpinTopSite(site) : LinkMenuOptions.PinTopSite(site, index))\n};\n\n\n\n// WEBPACK FOOTER //\n// ./system-addon/content-src/lib/link-menu-options.js","import {actionCreators as ac} from \"common/Actions.jsm\";\nimport {ContextMenu} from \"content-src/components/ContextMenu/ContextMenu\";\nimport {injectIntl} from \"react-intl\";\nimport {LinkMenuOptions} from \"content-src/lib/link-menu-options\";\nimport React from \"react\";\n\nconst DEFAULT_SITE_MENU_OPTIONS = [\"CheckPinTopSite\", \"EditTopSite\", \"Separator\", \"OpenInNewWindow\", \"OpenInPrivateWindow\", \"Separator\", \"BlockUrl\"];\n\nexport class _LinkMenu extends React.PureComponent {\n  getOptions() {\n    const {props} = this;\n    const {site, index, source} = props;\n\n    // Handle special case of default site\n    const propOptions = !site.isDefault ? props.options : DEFAULT_SITE_MENU_OPTIONS;\n\n    const options = propOptions.map(o => LinkMenuOptions[o](site, index, source)).map(option => {\n      const {action, impression, id, string_id, type, userEvent} = option;\n      if (!type && id) {\n        option.label = props.intl.formatMessage({id: string_id || id});\n        option.onClick = () => {\n          props.dispatch(action);\n          if (userEvent) {\n            props.dispatch(ac.UserEvent({\n              event: userEvent,\n              source,\n              action_position: index\n            }));\n          }\n          if (impression && props.shouldSendImpressionStats) {\n            props.dispatch(impression);\n          }\n        };\n      }\n      return option;\n    });\n\n    // This is for accessibility to support making each item tabbable.\n    // We want to know which item is the first and which item\n    // is the last, so we can close the context menu accordingly.\n    options[0].first = true;\n    options[options.length - 1].last = true;\n    return options;\n  }\n\n  render() {\n    return (<ContextMenu\n      visible={this.props.visible}\n      onUpdate={this.props.onUpdate}\n      options={this.getOptions()} />);\n  }\n}\n\nexport const LinkMenu = injectIntl(_LinkMenu);\n\n\n\n// WEBPACK FOOTER //\n// ./system-addon/content-src/components/LinkMenu/LinkMenu.jsx","import {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\nimport {FormattedMessage, injectIntl} from \"react-intl\";\nimport {ErrorBoundary} from \"content-src/components/ErrorBoundary/ErrorBoundary\";\nimport React from \"react\";\n\nconst VISIBLE = \"visible\";\nconst VISIBILITY_CHANGE_EVENT = \"visibilitychange\";\n\nfunction getFormattedMessage(message) {\n  return typeof message === \"string\" ? <span>{message}</span> : <FormattedMessage {...message} />;\n}\nfunction getCollapsed(props) {\n  return (props.prefName in props.Prefs.values) ? props.Prefs.values[props.prefName] : false;\n}\n\nexport class Info extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.onInfoEnter = this.onInfoEnter.bind(this);\n    this.onInfoLeave = this.onInfoLeave.bind(this);\n    this.onManageClick = this.onManageClick.bind(this);\n    this.state = {infoActive: false};\n  }\n\n  /**\n   * Take a truthy value to conditionally change the infoActive state.\n   */\n  _setInfoState(nextActive) {\n    const infoActive = !!nextActive;\n    if (infoActive !== this.state.infoActive) {\n      this.setState({infoActive});\n    }\n  }\n\n  onInfoEnter() {\n    // We're getting focus or hover, so info state should be true if not yet.\n    this._setInfoState(true);\n  }\n\n  onInfoLeave(event) {\n    // We currently have an active (true) info state, so keep it true only if we\n    // have a related event target that is contained \"within\" the current target\n    // (section-info-option) as itself or a descendant. Set to false otherwise.\n    this._setInfoState(event && event.relatedTarget && (\n      event.relatedTarget === event.currentTarget ||\n      (event.relatedTarget.compareDocumentPosition(event.currentTarget) &\n        Node.DOCUMENT_POSITION_CONTAINS)));\n  }\n\n  onManageClick() {\n    this.props.dispatch({type: at.SETTINGS_OPEN});\n    this.props.dispatch(ac.UserEvent({event: \"OPEN_NEWTAB_PREFS\"}));\n  }\n\n  render() {\n    const {infoOption, intl} = this.props;\n    const infoOptionIconA11yAttrs = {\n      \"aria-haspopup\": \"true\",\n      \"aria-controls\": \"info-option\",\n      \"aria-expanded\": this.state.infoActive ? \"true\" : \"false\",\n      \"role\": \"note\",\n      \"tabIndex\": 0\n    };\n    const sectionInfoTitle = intl.formatMessage({id: \"section_info_option\"});\n\n    return (\n      <span className=\"section-info-option\"\n        onBlur={this.onInfoLeave}\n        onFocus={this.onInfoEnter}\n        onMouseOut={this.onInfoLeave}\n        onMouseOver={this.onInfoEnter}>\n        <img className=\"info-option-icon\" title={sectionInfoTitle}\n          {...infoOptionIconA11yAttrs} />\n        <div className=\"info-option\">\n          {infoOption.header &&\n            <div className=\"info-option-header\" role=\"heading\">\n              {getFormattedMessage(infoOption.header)}\n            </div>}\n          <p className=\"info-option-body\">\n            {infoOption.body && getFormattedMessage(infoOption.body)}\n            {infoOption.link &&\n              <a href={infoOption.link.href} target=\"_blank\" rel=\"noopener noreferrer\" className=\"info-option-link\">\n                {getFormattedMessage(infoOption.link.title || infoOption.link)}\n              </a>\n            }\n          </p>\n          <div className=\"info-option-manage\">\n            <button onClick={this.onManageClick}>\n              <FormattedMessage id=\"settings_pane_header\" />\n            </button>\n          </div>\n        </div>\n      </span>\n    );\n  }\n}\n\nexport const InfoIntl = injectIntl(Info);\n\nexport class Disclaimer extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.onAcknowledge = this.onAcknowledge.bind(this);\n  }\n\n  onAcknowledge() {\n    this.props.dispatch(ac.SetPref(this.props.disclaimerPref, false));\n    this.props.dispatch(ac.UserEvent({event: \"SECTION_DISCLAIMER_ACKNOWLEDGED\", source: this.props.eventSource}));\n  }\n\n  render() {\n    const {disclaimer} = this.props;\n    return (\n      <div className=\"section-disclaimer\">\n          <div className=\"section-disclaimer-text\">\n            {getFormattedMessage(disclaimer.text)}\n            {disclaimer.link &&\n              <a href={disclaimer.link.href} target=\"_blank\" rel=\"noopener noreferrer\">\n                {getFormattedMessage(disclaimer.link.title || disclaimer.link)}\n              </a>\n            }\n          </div>\n\n          <button onClick={this.onAcknowledge}>\n            {getFormattedMessage(disclaimer.button)}\n          </button>\n      </div>\n    );\n  }\n}\n\nexport const DisclaimerIntl = injectIntl(Disclaimer);\n\nexport class _CollapsibleSection extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.onBodyMount = this.onBodyMount.bind(this);\n    this.onInfoEnter = this.onInfoEnter.bind(this);\n    this.onInfoLeave = this.onInfoLeave.bind(this);\n    this.onHeaderClick = this.onHeaderClick.bind(this);\n    this.onTransitionEnd = this.onTransitionEnd.bind(this);\n    this.enableOrDisableAnimation = this.enableOrDisableAnimation.bind(this);\n    this.state = {enableAnimation: true, isAnimating: false, infoActive: false};\n  }\n\n  componentWillMount() {\n    this.props.document.addEventListener(VISIBILITY_CHANGE_EVENT, this.enableOrDisableAnimation);\n  }\n\n  componentWillUpdate(nextProps) {\n    // Check if we're about to go from expanded to collapsed\n    if (!getCollapsed(this.props) && getCollapsed(nextProps)) {\n      // This next line forces a layout flush of the section body, which has a\n      // max-height style set, so that the upcoming collapse animation can\n      // animate from that height to the collapsed height. Without this, the\n      // update is coalesced and there's no animation from no-max-height to 0.\n      this.sectionBody.scrollHeight; // eslint-disable-line no-unused-expressions\n    }\n  }\n\n  componentWillUnmount() {\n    this.props.document.removeEventListener(VISIBILITY_CHANGE_EVENT, this.enableOrDisableAnimation);\n  }\n\n  enableOrDisableAnimation() {\n    // Only animate the collapse/expand for visible tabs.\n    const visible = this.props.document.visibilityState === VISIBLE;\n    if (this.state.enableAnimation !== visible) {\n      this.setState({enableAnimation: visible});\n    }\n  }\n\n  _setInfoState(nextActive) {\n    // Take a truthy value to conditionally change the infoActive state.\n    const infoActive = !!nextActive;\n    if (infoActive !== this.state.infoActive) {\n      this.setState({infoActive});\n    }\n  }\n\n  onBodyMount(node) {\n    this.sectionBody = node;\n  }\n\n  onInfoEnter() {\n    // We're getting focus or hover, so info state should be true if not yet.\n    this._setInfoState(true);\n  }\n\n  onInfoLeave(event) {\n    // We currently have an active (true) info state, so keep it true only if we\n    // have a related event target that is contained \"within\" the current target\n    // (section-info-option) as itself or a descendant. Set to false otherwise.\n    this._setInfoState(event && event.relatedTarget && (\n      event.relatedTarget === event.currentTarget ||\n      (event.relatedTarget.compareDocumentPosition(event.currentTarget) &\n        Node.DOCUMENT_POSITION_CONTAINS)));\n  }\n\n  onHeaderClick() {\n    // If this.sectionBody is unset, it means that we're in some sort of error\n    // state, probably displaying the error fallback, so we won't be able to\n    // compute the height, and we don't want to persist the preference.\n    if (!this.sectionBody) {\n      return;\n    }\n\n    // Get the current height of the body so max-height transitions can work\n    this.setState({\n      isAnimating: true,\n      maxHeight: `${this.sectionBody.scrollHeight}px`\n    });\n    this.props.dispatch(ac.SetPref(this.props.prefName, !getCollapsed(this.props)));\n  }\n\n  onTransitionEnd(event) {\n    // Only update the animating state for our own transition (not a child's)\n    if (event.target === event.currentTarget) {\n      this.setState({isAnimating: false});\n    }\n  }\n\n  renderIcon() {\n    const {icon} = this.props;\n    if (icon && icon.startsWith(\"moz-extension://\")) {\n      return <span className=\"icon icon-small-spacer\" style={{backgroundImage: `url('${icon}')`}} />;\n    }\n    return <span className={`icon icon-small-spacer icon-${icon || \"webextension\"}`} />;\n  }\n\n  render() {\n    const isCollapsible = this.props.prefName in this.props.Prefs.values;\n    const isCollapsed = getCollapsed(this.props);\n    const {enableAnimation, isAnimating, maxHeight} = this.state;\n    const {id, infoOption, eventSource, disclaimer} = this.props;\n    const disclaimerPref = `section.${id}.showDisclaimer`;\n    const needsDisclaimer = disclaimer && this.props.Prefs.values[disclaimerPref];\n\n    return (\n      <section className={`collapsible-section ${this.props.className}${enableAnimation ? \" animation-enabled\" : \"\"}${isCollapsed ? \" collapsed\" : \"\"}`}>\n        <div className=\"section-top-bar\">\n          <h3 className=\"section-title\">\n            <span className=\"click-target\" onClick={isCollapsible && this.onHeaderClick}>\n              {this.renderIcon()}\n              {this.props.title}\n            {isCollapsible && <span className={`collapsible-arrow icon ${isCollapsed ? \"icon-arrowhead-forward\" : \"icon-arrowhead-down\"}`} />}\n            </span>\n          </h3>\n          {infoOption && <InfoIntl infoOption={infoOption} dispatch={this.props.dispatch} />}\n        </div>\n        <ErrorBoundary className=\"section-body-fallback\">\n          <div\n            className={`section-body${isAnimating ? \" animating\" : \"\"}`}\n            onTransitionEnd={this.onTransitionEnd}\n            ref={this.onBodyMount}\n            style={isAnimating && !isCollapsed ? {maxHeight} : null}>\n            {needsDisclaimer && <DisclaimerIntl disclaimerPref={disclaimerPref} disclaimer={disclaimer} eventSource={eventSource} dispatch={this.props.dispatch} />}\n            {this.props.children}\n          </div>\n        </ErrorBoundary>\n      </section>\n    );\n  }\n}\n\n_CollapsibleSection.defaultProps = {\n  document: global.document || {\n    addEventListener: () => {},\n    removeEventListener: () => {},\n    visibilityState: \"hidden\"\n  },\n  Prefs: {values: {}}\n};\n\nexport const CollapsibleSection = injectIntl(_CollapsibleSection);\n\n\n\n// WEBPACK FOOTER //\n// ./system-addon/content-src/components/CollapsibleSection/CollapsibleSection.jsx","import {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\nimport {perfService as perfSvc} from \"common/PerfService.jsm\";\nimport React from \"react\";\n\n// Currently record only a fixed set of sections. This will prevent data\n// from custom sections from showing up or from topstories.\nconst RECORDED_SECTIONS = [\"highlights\", \"topsites\"];\n\nexport class ComponentPerfTimer extends React.Component {\n  constructor(props) {\n    super(props);\n    // Just for test dependency injection:\n    this.perfSvc = this.props.perfSvc || perfSvc;\n\n    this._sendBadStateEvent = this._sendBadStateEvent.bind(this);\n    this._sendPaintedEvent = this._sendPaintedEvent.bind(this);\n    this._reportMissingData = false;\n    this._timestampHandled = false;\n    this._recordedFirstRender = false;\n  }\n\n  componentDidMount() {\n    if (!RECORDED_SECTIONS.includes(this.props.id)) {\n      return;\n    }\n\n    this._maybeSendPaintedEvent();\n  }\n\n  componentDidUpdate() {\n    if (!RECORDED_SECTIONS.includes(this.props.id)) {\n      return;\n    }\n\n    this._maybeSendPaintedEvent();\n  }\n\n  /**\n   * Call the given callback after the upcoming frame paints.\n   *\n   * @note Both setTimeout and requestAnimationFrame are throttled when the page\n   * is hidden, so this callback may get called up to a second or so after the\n   * requestAnimationFrame \"paint\" for hidden tabs.\n   *\n   * Newtabs hidden while loading will presumably be fairly rare (other than\n   * preloaded tabs, which we will be filtering out on the server side), so such\n   * cases should get lost in the noise.\n   *\n   * If we decide that it's important to find out when something that's hidden\n   * has \"painted\", however, another option is to post a message to this window.\n   * That should happen even faster than setTimeout, and, at least as of this\n   * writing, it's not throttled in hidden windows in Firefox.\n   *\n   * @param {Function} callback\n   *\n   * @returns void\n   */\n  _afterFramePaint(callback) {\n    requestAnimationFrame(() => setTimeout(callback, 0));\n  }\n\n  _maybeSendBadStateEvent() {\n    // Follow up bugs:\n    // https://github.com/mozilla/activity-stream/issues/3691\n    if (!this.props.initialized) {\n      // Remember to report back when data is available.\n      this._reportMissingData = true;\n    } else if (this._reportMissingData) {\n      this._reportMissingData = false;\n      // Report how long it took for component to become initialized.\n      this._sendBadStateEvent();\n    }\n  }\n\n  _maybeSendPaintedEvent() {\n    // If we've already handled a timestamp, don't do it again.\n    if (this._timestampHandled || !this.props.initialized) {\n      return;\n    }\n\n    // And if we haven't, we're doing so now, so remember that. Even if\n    // something goes wrong in the callback, we can't try again, as we'd be\n    // sending back the wrong data, and we have to do it here, so that other\n    // calls to this method while waiting for the next frame won't also try to\n    // handle it.\n    this._timestampHandled = true;\n    this._afterFramePaint(this._sendPaintedEvent);\n  }\n\n  /**\n   * Triggered by call to render. Only first call goes through due to\n   * `_recordedFirstRender`.\n   */\n  _ensureFirstRenderTsRecorded() {\n    // Used as t0 for recording how long component took to initialize.\n    if (!this._recordedFirstRender) {\n      this._recordedFirstRender = true;\n      // topsites_first_render_ts, highlights_first_render_ts.\n      const key = `${this.props.id}_first_render_ts`;\n      this.perfSvc.mark(key);\n    }\n  }\n\n  /**\n   * Creates `TELEMETRY_UNDESIRED_EVENT` with timestamp in ms\n   * of how much longer the data took to be ready for display than it would\n   * have been the ideal case.\n   * https://github.com/mozilla/ping-centre/issues/98\n   */\n  _sendBadStateEvent() {\n    // highlights_data_ready_ts, topsites_data_ready_ts.\n    const dataReadyKey = `${this.props.id}_data_ready_ts`;\n    this.perfSvc.mark(dataReadyKey);\n\n    try {\n      const firstRenderKey = `${this.props.id}_first_render_ts`;\n      // value has to be Int32.\n      const value = parseInt(this.perfSvc.getMostRecentAbsMarkStartByName(dataReadyKey) -\n                             this.perfSvc.getMostRecentAbsMarkStartByName(firstRenderKey), 10);\n      this.props.dispatch(ac.OnlyToMain({\n        type: at.SAVE_SESSION_PERF_DATA,\n        // highlights_data_late_by_ms, topsites_data_late_by_ms.\n        data: {[`${this.props.id}_data_late_by_ms`]: value}\n      }));\n    } catch (ex) {\n      // If this failed, it's likely because the `privacy.resistFingerprinting`\n      // pref is true.\n    }\n  }\n\n  _sendPaintedEvent() {\n    // Record first_painted event but only send if topsites.\n    if (this.props.id !== \"topsites\") {\n      return;\n    }\n\n    // topsites_first_painted_ts.\n    const key = `${this.props.id}_first_painted_ts`;\n    this.perfSvc.mark(key);\n\n    try {\n      const data = {};\n      data[key] = this.perfSvc.getMostRecentAbsMarkStartByName(key);\n\n      this.props.dispatch(ac.OnlyToMain({\n        type: at.SAVE_SESSION_PERF_DATA,\n        data\n      }));\n    } catch (ex) {\n      // If this failed, it's likely because the `privacy.resistFingerprinting`\n      // pref is true.  We should at least not blow up, and should continue\n      // to set this._timestampHandled to avoid going through this again.\n    }\n  }\n\n  render() {\n    if (RECORDED_SECTIONS.includes(this.props.id)) {\n      this._ensureFirstRenderTsRecorded();\n      this._maybeSendBadStateEvent();\n    }\n    return this.props.children;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./system-addon/content-src/components/ComponentPerfTimer/ComponentPerfTimer.jsx","/* globals Services */\n\"use strict\";\n\n/* istanbul ignore if */\nif (typeof ChromeUtils !== \"undefined\") {\n  ChromeUtils.import(\"resource://gre/modules/Services.jsm\");\n}\n\nlet usablePerfObj;\n\n/* istanbul ignore if */\n/* istanbul ignore else */\nif (typeof Services !== \"undefined\") {\n  // Borrow the high-resolution timer from the hidden window....\n  usablePerfObj = Services.appShell.hiddenDOMWindow.performance;\n} else if (typeof performance !== \"undefined\") {\n  // we must be running in content space\n  // eslint-disable-next-line no-undef\n  usablePerfObj = performance;\n} else {\n  // This is a dummy object so this file doesn't crash in the node prerendering\n  // task.\n  usablePerfObj = {\n    now() {},\n    mark() {}\n  };\n}\n\nthis._PerfService = function _PerfService(options) {\n  // For testing, so that we can use a fake Window.performance object with\n  // known state.\n  if (options && options.performanceObj) {\n    this._perf = options.performanceObj;\n  } else {\n    this._perf = usablePerfObj;\n  }\n};\n\n_PerfService.prototype = {\n  /**\n   * Calls the underlying mark() method on the appropriate Window.performance\n   * object to add a mark with the given name to the appropriate performance\n   * timeline.\n   *\n   * @param  {String} name  the name to give the current mark\n   * @return {void}\n   */\n  mark: function mark(str) {\n    this._perf.mark(str);\n  },\n\n  /**\n   * Calls the underlying getEntriesByName on the appropriate Window.performance\n   * object.\n   *\n   * @param  {String} name\n   * @param  {String} type eg \"mark\"\n   * @return {Array}       Performance* objects\n   */\n  getEntriesByName: function getEntriesByName(name, type) {\n    return this._perf.getEntriesByName(name, type);\n  },\n\n  /**\n   * The timeOrigin property from the appropriate performance object.\n   * Used to ensure that timestamps from the add-on code and the content code\n   * are comparable.\n   *\n   * @note If this is called from a context without a window\n   * (eg a JSM in chrome), it will return the timeOrigin of the XUL hidden\n   * window, which appears to be the first created window (and thus\n   * timeOrigin) in the browser.  Note also, however, there is also a private\n   * hidden window, presumably for private browsing, which appears to be\n   * created dynamically later.  Exactly how/when that shows up needs to be\n   * investigated.\n   *\n   * @return {Number} A double of milliseconds with a precision of 0.5us.\n   */\n  get timeOrigin() {\n    return this._perf.timeOrigin;\n  },\n\n  /**\n   * Returns the \"absolute\" version of performance.now(), i.e. one that\n   * should ([bug 1401406](https://bugzilla.mozilla.org/show_bug.cgi?id=1401406)\n   * be comparable across both chrome and content.\n   *\n   * @return {Number}\n   */\n  absNow: function absNow() {\n    return this.timeOrigin + this._perf.now();\n  },\n\n  /**\n   * This returns the absolute startTime from the most recent performance.mark()\n   * with the given name.\n   *\n   * @param  {String} name  the name to lookup the start time for\n   *\n   * @return {Number}       the returned start time, as a DOMHighResTimeStamp\n   *\n   * @throws {Error}        \"No Marks with the name ...\" if none are available\n   *\n   * @note Always surround calls to this by try/catch.  Otherwise your code\n   * may fail when the `privacy.resistFingerprinting` pref is true.  When\n   * this pref is set, all attempts to get marks will likely fail, which will\n   * cause this method to throw.\n   *\n   * See [bug 1369303](https://bugzilla.mozilla.org/show_bug.cgi?id=1369303)\n   * for more info.\n   */\n  getMostRecentAbsMarkStartByName(name) {\n    let entries = this.getEntriesByName(name, \"mark\");\n\n    if (!entries.length) {\n      throw new Error(`No marks with the name ${name}`);\n    }\n\n    let mostRecentEntry = entries[entries.length - 1];\n    return this._perf.timeOrigin + mostRecentEntry.startTime;\n  }\n};\n\nthis.perfService = new _PerfService();\nthis.EXPORTED_SYMBOLS = [\"_PerfService\", \"perfService\"];\n\n\n\n// WEBPACK FOOTER //\n// ./system-addon/common/PerfService.jsm","import {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\nimport {addSnippetsSubscriber} from \"content-src/lib/snippets\";\nimport {Base} from \"content-src/components/Base/Base\";\nimport {DetectUserSessionStart} from \"content-src/lib/detect-user-session-start\";\nimport {initStore} from \"content-src/lib/init-store\";\nimport {Provider} from \"react-redux\";\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport {reducers} from \"common/Reducers.jsm\";\n\nconst store = initStore(reducers, global.gActivityStreamPrerenderedState);\n\nnew DetectUserSessionStart(store).sendEventOrAddListener();\n\n// If we are starting in a prerendered state, we must wait until the first render\n// to request state rehydration (see Base.jsx). If we are NOT in a prerendered state,\n// we can request it immedately.\nif (!global.gActivityStreamPrerenderedState) {\n  store.dispatch(ac.AlsoToMain({type: at.NEW_TAB_STATE_REQUEST}));\n}\n\nReactDOM.hydrate(<Provider store={store}>\n  <Base\n    isPrerendered={!!global.gActivityStreamPrerenderedState}\n    locale={global.document.documentElement.lang}\n    strings={global.gActivityStreamStrings} />\n</Provider>, document.getElementById(\"root\"));\n\naddSnippetsSubscriber(store);\n\n\n\n// WEBPACK FOOTER //\n// ./system-addon/content-src/activity-stream.jsx","const DATABASE_NAME = \"snippets_db\";\nconst DATABASE_VERSION = 1;\nconst SNIPPETS_OBJECTSTORE_NAME = \"snippets\";\nexport const SNIPPETS_UPDATE_INTERVAL_MS = 14400000; // 4 hours.\n\nconst SNIPPETS_ENABLED_EVENT = \"Snippets:Enabled\";\nconst SNIPPETS_DISABLED_EVENT = \"Snippets:Disabled\";\n\nimport {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\n\n/**\n * SnippetsMap - A utility for cacheing values related to the snippet. It has\n *               the same interface as a Map, but is optionally backed by\n *               indexedDB for persistent storage.\n *               Call .connect() to open a database connection and restore any\n *               previously cached data, if necessary.\n *\n */\nexport class SnippetsMap extends Map {\n  constructor(dispatch) {\n    super();\n    this._db = null;\n    this._dispatch = dispatch;\n  }\n\n  set(key, value) {\n    super.set(key, value);\n    return this._dbTransaction(db => db.put(value, key));\n  }\n\n  delete(key) {\n    super.delete(key);\n    return this._dbTransaction(db => db.delete(key));\n  }\n\n  clear() {\n    super.clear();\n    return this._dbTransaction(db => db.clear());\n  }\n\n  get blockList() {\n    return this.get(\"blockList\") || [];\n  }\n\n  /**\n   * blockSnippetById - Blocks a snippet given an id\n   *\n   * @param  {str|int} id   The id of the snippet\n   * @return {Promise}      Resolves when the id has been written to indexedDB,\n   *                        or immediately if the snippetMap is not connected\n   */\n  async blockSnippetById(id) {\n    if (!id) {\n      return;\n    }\n    const {blockList} = this;\n    if (!blockList.includes(id)) {\n      blockList.push(id);\n      this._dispatch(ac.AlsoToMain({type: at.SNIPPETS_BLOCKLIST_UPDATED, data: blockList}));\n      await this.set(\"blockList\", blockList);\n    }\n  }\n\n  disableOnboarding() {\n    this._dispatch(ac.AlsoToMain({type: at.DISABLE_ONBOARDING}));\n  }\n\n  showFirefoxAccounts() {\n    this._dispatch(ac.AlsoToMain({type: at.SHOW_FIREFOX_ACCOUNTS}));\n  }\n\n  /**\n   * connect - Attaches an indexedDB back-end to the Map so that any set values\n   *           are also cached in a store. It also restores any existing values\n   *           that are already stored in the indexedDB store.\n   *\n   * @return {type}  description\n   */\n  async connect() {\n    // Open the connection\n    const db = await this._openDB();\n\n    // Restore any existing values\n    await this._restoreFromDb(db);\n\n    // Attach a reference to the db\n    this._db = db;\n  }\n\n  /**\n   * _dbTransaction - Returns a db transaction wrapped with the given modifier\n   *                  function as a Promise. If the db has not been connected,\n   *                  it resolves immediately.\n   *\n   * @param  {func} modifier A function to call with the transaction\n   * @return {obj}           A Promise that resolves when the transaction has\n   *                         completed or errored\n   */\n  _dbTransaction(modifier) {\n    if (!this._db) {\n      return Promise.resolve();\n    }\n    return new Promise((resolve, reject) => {\n      const transaction = modifier(\n        this._db\n          .transaction(SNIPPETS_OBJECTSTORE_NAME, \"readwrite\")\n          .objectStore(SNIPPETS_OBJECTSTORE_NAME)\n      );\n      transaction.onsuccess = event => resolve();\n\n      /* istanbul ignore next */\n      transaction.onerror = event => reject(transaction.error);\n    });\n  }\n\n  _openDB() {\n    return new Promise((resolve, reject) => {\n      const openRequest = indexedDB.open(DATABASE_NAME, DATABASE_VERSION);\n\n      /* istanbul ignore next */\n      openRequest.onerror = event => {\n        // Try to delete the old database so that we can start this process over\n        // next time.\n        indexedDB.deleteDatabase(DATABASE_NAME);\n        reject(event);\n      };\n\n      openRequest.onupgradeneeded = event => {\n        const db = event.target.result;\n        if (!db.objectStoreNames.contains(SNIPPETS_OBJECTSTORE_NAME)) {\n          db.createObjectStore(SNIPPETS_OBJECTSTORE_NAME);\n        }\n      };\n\n      openRequest.onsuccess = event => {\n        let db = event.target.result;\n\n        /* istanbul ignore next */\n        db.onerror = err => console.error(err); // eslint-disable-line no-console\n        /* istanbul ignore next */\n        db.onversionchange = versionChangeEvent => versionChangeEvent.target.close();\n\n        resolve(db);\n      };\n    });\n  }\n\n  _restoreFromDb(db) {\n    return new Promise((resolve, reject) => {\n      let cursorRequest;\n      try {\n        cursorRequest = db.transaction(SNIPPETS_OBJECTSTORE_NAME)\n          .objectStore(SNIPPETS_OBJECTSTORE_NAME).openCursor();\n      } catch (err) {\n        // istanbul ignore next\n        reject(err);\n        // istanbul ignore next\n        return;\n      }\n\n      /* istanbul ignore next */\n      cursorRequest.onerror = event => reject(event);\n\n      cursorRequest.onsuccess = event => {\n        let cursor = event.target.result;\n        // Populate the cache from the persistent storage.\n        if (cursor) {\n          this.set(cursor.key, cursor.value);\n          cursor.continue();\n        } else {\n          // We are done.\n          resolve();\n        }\n      };\n    });\n  }\n}\n\n/**\n * SnippetsProvider - Initializes a SnippetsMap and loads snippets from a\n *                    remote location, or else default snippets if the remote\n *                    snippets cannot be retrieved.\n */\nexport class SnippetsProvider {\n  constructor(dispatch) {\n    // Initialize the Snippets Map and attaches it to a global so that\n    // the snippet payload can interact with it.\n    global.gSnippetsMap = new SnippetsMap(dispatch);\n    this._onAction = this._onAction.bind(this);\n  }\n\n  get snippetsMap() {\n    return global.gSnippetsMap;\n  }\n\n  async _refreshSnippets() {\n    // Check if the cached version of of the snippets in snippetsMap. If it's too\n    // old, blow away the entire snippetsMap.\n    const cachedVersion = this.snippetsMap.get(\"snippets-cached-version\");\n\n    if (cachedVersion !== this.appData.version) {\n      this.snippetsMap.clear();\n    }\n\n    // Has enough time passed for us to require an update?\n    const lastUpdate = this.snippetsMap.get(\"snippets-last-update\");\n    const needsUpdate = !(lastUpdate >= 0) || Date.now() - lastUpdate > SNIPPETS_UPDATE_INTERVAL_MS;\n\n    if (needsUpdate && this.appData.snippetsURL) {\n      this.snippetsMap.set(\"snippets-last-update\", Date.now());\n      try {\n        const response = await fetch(this.appData.snippetsURL);\n        if (response.status === 200) {\n          const payload = await response.text();\n\n          this.snippetsMap.set(\"snippets\", payload);\n          this.snippetsMap.set(\"snippets-cached-version\", this.appData.version);\n        }\n      } catch (e) {\n        console.error(e); // eslint-disable-line no-console\n      }\n    }\n  }\n\n  _noSnippetFallback() {\n    // TODO\n  }\n\n  _forceOnboardingVisibility(shouldBeVisible) {\n    const onboardingEl = document.getElementById(\"onboarding-notification-bar\");\n\n    if (onboardingEl) {\n      onboardingEl.style.display = shouldBeVisible ? \"\" : \"none\";\n    }\n  }\n\n  _showRemoteSnippets() {\n    const snippetsEl = document.getElementById(this.elementId);\n    const payload = this.snippetsMap.get(\"snippets\");\n\n    if (!snippetsEl) {\n      throw new Error(`No element was found with id '${this.elementId}'.`);\n    }\n\n    // This could happen if fetching failed\n    if (!payload) {\n      throw new Error(\"No remote snippets were found in gSnippetsMap.\");\n    }\n\n    if (typeof payload !== \"string\") {\n      throw new Error(\"Snippet payload was incorrectly formatted\");\n    }\n\n    // Note that injecting snippets can throw if they're invalid XML.\n    // eslint-disable-next-line no-unsanitized/property\n    snippetsEl.innerHTML = payload;\n\n    // Scripts injected by innerHTML are inactive, so we have to relocate them\n    // through DOM manipulation to activate their contents.\n    for (const scriptEl of snippetsEl.getElementsByTagName(\"script\")) {\n      const relocatedScript = document.createElement(\"script\");\n      relocatedScript.text = scriptEl.text;\n      scriptEl.parentNode.replaceChild(relocatedScript, scriptEl);\n    }\n  }\n\n  _onAction(msg) {\n    if (msg.data.type === at.SNIPPET_BLOCKED) {\n      this.snippetsMap.set(\"blockList\", msg.data.data);\n      document.getElementById(\"snippets-container\").style.display = \"none\";\n    }\n  }\n\n  /**\n   * init - Fetch the snippet payload and show snippets\n   *\n   * @param  {obj} options\n   * @param  {str} options.appData.snippetsURL  The URL from which we fetch snippets\n   * @param  {int} options.appData.version  The current snippets version\n   * @param  {str} options.elementId  The id of the element in which to inject snippets\n   * @param  {bool} options.connect  Should gSnippetsMap connect to indexedDB?\n   */\n  async init(options) {\n    Object.assign(this, {\n      appData: {},\n      elementId: \"snippets\",\n      connect: true\n    }, options);\n\n    // Add listener so we know when snippets are blocked on other pages\n    if (global.addMessageListener) {\n      global.addMessageListener(\"ActivityStream:MainToContent\", this._onAction);\n    }\n\n    // TODO: Requires enabling indexedDB on newtab\n    // Restore the snippets map from indexedDB\n    if (this.connect) {\n      try {\n        await this.snippetsMap.connect();\n      } catch (e) {\n        console.error(e); // eslint-disable-line no-console\n      }\n    }\n\n    // Cache app data values so they can be accessible from gSnippetsMap\n    for (const key of Object.keys(this.appData)) {\n      this.snippetsMap.set(`appData.${key}`, this.appData[key]);\n    }\n\n    // Refresh snippets, if enough time has passed.\n    await this._refreshSnippets();\n\n    // Try showing remote snippets, falling back to defaults if necessary.\n    try {\n      this._showRemoteSnippets();\n    } catch (e) {\n      this._noSnippetFallback(e);\n    }\n\n    window.dispatchEvent(new Event(SNIPPETS_ENABLED_EVENT));\n\n    this._forceOnboardingVisibility(true);\n    this.initialized = true;\n  }\n\n  uninit() {\n    window.dispatchEvent(new Event(SNIPPETS_DISABLED_EVENT));\n    this._forceOnboardingVisibility(false);\n    if (global.removeMessageListener) {\n      global.removeMessageListener(\"ActivityStream:MainToContent\", this._onAction);\n    }\n    this.initialized = false;\n  }\n}\n\n/**\n * addSnippetsSubscriber - Creates a SnippetsProvider that Initializes\n *                         when the store has received the appropriate\n *                         Snippet data.\n *\n * @param  {obj} store   The redux store\n * @return {obj}         Returns the snippets instance and unsubscribe function\n */\nexport function addSnippetsSubscriber(store) {\n  const snippets = new SnippetsProvider(store.dispatch);\n\n  let initializing = false;\n\n  store.subscribe(async () => {\n    const state = store.getState();\n    // state.Prefs.values[\"feeds.snippets\"]:  Should snippets be shown?\n    // state.Snippets.initialized             Is the snippets data initialized?\n    // snippets.initialized:                  Is SnippetsProvider currently initialised?\n    if (state.Prefs.values[\"feeds.snippets\"] &&\n      !state.Prefs.values.disableSnippets &&\n      state.Snippets.initialized &&\n      !snippets.initialized &&\n      // Don't call init multiple times\n      !initializing\n    ) {\n      initializing = true;\n      await snippets.init({appData: state.Snippets});\n      initializing = false;\n    } else if (\n      (state.Prefs.values[\"feeds.snippets\"] === false ||\n        state.Prefs.values.disableSnippets === true) &&\n      snippets.initialized\n    ) {\n      snippets.uninit();\n    }\n  });\n\n  // These values are returned for testing purposes\n  return snippets;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./system-addon/content-src/lib/snippets.js","import {actionCreators as ac, actionTypes} from \"common/Actions.jsm\";\nimport {connect} from \"react-redux\";\nimport {FormattedMessage} from \"react-intl\";\nimport React from \"react\";\n\n/**\n * ConfirmDialog component.\n * One primary action button, one cancel button.\n *\n * Content displayed is controlled by `data` prop the component receives.\n * Example:\n * data: {\n *   // Any sort of data needed to be passed around by actions.\n *   payload: site.url,\n *   // Primary button AlsoToMain action.\n *   action: \"DELETE_HISTORY_URL\",\n *   // Primary button USerEvent action.\n *   userEvent: \"DELETE\",\n *   // Array of locale ids to display.\n *   message_body: [\"confirm_history_delete_p1\", \"confirm_history_delete_notice_p2\"],\n *   // Text for primary button.\n *   confirm_button_string_id: \"menu_action_delete\"\n * },\n */\nexport class _ConfirmDialog extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this._handleCancelBtn = this._handleCancelBtn.bind(this);\n    this._handleConfirmBtn = this._handleConfirmBtn.bind(this);\n  }\n\n  _handleCancelBtn() {\n    this.props.dispatch({type: actionTypes.DIALOG_CANCEL});\n    this.props.dispatch(ac.UserEvent({event: actionTypes.DIALOG_CANCEL}));\n  }\n\n  _handleConfirmBtn() {\n    this.props.data.onConfirm.forEach(this.props.dispatch);\n  }\n\n  _renderModalMessage() {\n    const message_body = this.props.data.body_string_id;\n\n    if (!message_body) {\n      return null;\n    }\n\n    return (<span>\n      {message_body.map(msg => <p key={msg}><FormattedMessage id={msg} /></p>)}\n    </span>);\n  }\n\n  render() {\n    if (!this.props.visible) {\n      return null;\n    }\n\n    return (<div className=\"confirmation-dialog\">\n      <div className=\"modal-overlay\" onClick={this._handleCancelBtn} />\n      <div className=\"modal\">\n        <section className=\"modal-message\">\n          {this.props.data.icon && <span className={`icon icon-spacer icon-${this.props.data.icon}`} />}\n          {this._renderModalMessage()}\n        </section>\n        <section className=\"actions\">\n          <button onClick={this._handleCancelBtn}>\n            <FormattedMessage id={this.props.data.cancel_button_string_id} />\n          </button>\n          <button className=\"done\" onClick={this._handleConfirmBtn}>\n            <FormattedMessage id={this.props.data.confirm_button_string_id} />\n          </button>\n        </section>\n      </div>\n    </div>);\n  }\n}\n\nexport const ConfirmDialog = connect(state => state.Dialog)(_ConfirmDialog);\n\n\n\n// WEBPACK FOOTER //\n// ./system-addon/content-src/components/ConfirmDialog/ConfirmDialog.jsx","import {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\nimport {connect} from \"react-redux\";\nimport {FormattedMessage} from \"react-intl\";\nimport React from \"react\";\n\n/**\n * Manual migration component used to start the profile import wizard.\n * Message is presented temporarily and will go away if:\n * 1.  User clicks \"No Thanks\"\n * 2.  User completed the data import\n * 3.  After 3 active days\n * 4.  User clicks \"Cancel\" on the import wizard (currently not implemented).\n */\nexport class _ManualMigration extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.onLaunchTour = this.onLaunchTour.bind(this);\n    this.onCancelTour = this.onCancelTour.bind(this);\n  }\n\n  onLaunchTour() {\n    this.props.dispatch(ac.AlsoToMain({type: at.MIGRATION_START}));\n    this.props.dispatch(ac.UserEvent({event: at.MIGRATION_START}));\n  }\n\n  onCancelTour() {\n    this.props.dispatch(ac.AlsoToMain({type: at.MIGRATION_CANCEL}));\n    this.props.dispatch(ac.UserEvent({event: at.MIGRATION_CANCEL}));\n  }\n\n  render() {\n    return (<div className=\"manual-migration-container\">\n        <p>\n          <span className=\"icon icon-import\" />\n          <FormattedMessage id=\"manual_migration_explanation2\" />\n        </p>\n        <div className=\"manual-migration-actions actions\">\n          <button className=\"dismiss\" onClick={this.onCancelTour}>\n            <FormattedMessage id=\"manual_migration_cancel_button\" />\n          </button>\n          <button onClick={this.onLaunchTour}>\n            <FormattedMessage id=\"manual_migration_import_button\" />\n          </button>\n        </div>\n    </div>);\n  }\n}\n\nexport const ManualMigration = connect()(_ManualMigration);\n\n\n\n// WEBPACK FOOTER //\n// ./system-addon/content-src/components/ManualMigration/ManualMigration.jsx","import {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\nimport {FormattedMessage, injectIntl} from \"react-intl\";\nimport {connect} from \"react-redux\";\nimport React from \"react\";\n\nconst getFormattedMessage = message =>\n  (typeof message === \"string\" ? <span>{message}</span> : <FormattedMessage {...message} />);\n\nexport const PreferencesInput = props => (\n  <section>\n    <input type=\"checkbox\" id={props.prefName} name={props.prefName} checked={props.value} disabled={props.disabled} onChange={props.onChange} className={props.className} />\n    <label htmlFor={props.prefName} className={props.labelClassName}>\n      {getFormattedMessage(props.titleString)}\n    </label>\n    {props.descString && <p className=\"prefs-input-description\">\n      {getFormattedMessage(props.descString)}\n    </p>}\n    {React.Children.map(props.children,\n      child => <div className={`options${child.props.disabled ? \" disabled\" : \"\"}`}>{child}</div>)}\n  </section>\n);\n\nexport class _PreferencesPane extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.handleClickOutside = this.handleClickOutside.bind(this);\n    this.handlePrefChange = this.handlePrefChange.bind(this);\n    this.handleSectionChange = this.handleSectionChange.bind(this);\n    this.togglePane = this.togglePane.bind(this);\n    this.onWrapperMount = this.onWrapperMount.bind(this);\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    if (prevProps.PreferencesPane.visible !== this.props.PreferencesPane.visible) {\n      // While the sidebar is open, listen for all document clicks.\n      if (this.isSidebarOpen()) {\n        document.addEventListener(\"click\", this.handleClickOutside);\n      } else {\n        document.removeEventListener(\"click\", this.handleClickOutside);\n      }\n    }\n  }\n\n  isSidebarOpen() {\n    return this.props.PreferencesPane.visible;\n  }\n\n  handleClickOutside(event) {\n    // if we are showing the sidebar and there is a click outside, close it.\n    if (this.isSidebarOpen() && !this.wrapper.contains(event.target)) {\n      this.togglePane();\n    }\n  }\n\n  handlePrefChange({target: {name, checked}}) {\n    let value = checked;\n    if (name === \"topSitesRows\") {\n      value = checked ? 2 : 1;\n    }\n    this.props.dispatch(ac.SetPref(name, value));\n  }\n\n  handleSectionChange({target}) {\n    const id = target.name;\n    const type = target.checked ? at.SECTION_ENABLE : at.SECTION_DISABLE;\n    this.props.dispatch(ac.AlsoToMain({type, data: id}));\n  }\n\n  togglePane() {\n    if (this.isSidebarOpen()) {\n      this.props.dispatch({type: at.SETTINGS_CLOSE});\n      this.props.dispatch(ac.UserEvent({event: \"CLOSE_NEWTAB_PREFS\"}));\n    } else {\n      this.props.dispatch({type: at.SETTINGS_OPEN});\n      this.props.dispatch(ac.UserEvent({event: \"OPEN_NEWTAB_PREFS\"}));\n    }\n  }\n\n  onWrapperMount(wrapper) {\n    this.wrapper = wrapper;\n  }\n\n  render() {\n    const {props} = this;\n    const prefs = props.Prefs.values;\n    const sections = props.Sections;\n    const isVisible = this.isSidebarOpen();\n    return (\n      <div className=\"prefs-pane-wrapper\" ref={this.onWrapperMount}>\n        <div className=\"prefs-pane-button\">\n          <button\n            className={`prefs-button icon ${isVisible ? \"icon-dismiss\" : \"icon-settings\"}`}\n            title={props.intl.formatMessage({id: isVisible ? \"settings_pane_done_button\" : \"settings_pane_button_label\"})}\n            onClick={this.togglePane} />\n        </div>\n        <div className=\"prefs-pane\">\n          <div className={`sidebar ${isVisible ? \"\" : \"hidden\"}`}>\n            <div className=\"prefs-modal-inner-wrapper\">\n              <h1><FormattedMessage id=\"settings_pane_header\" /></h1>\n              <p><FormattedMessage id=\"settings_pane_body2\" /></p>\n\n              <PreferencesInput\n                className=\"showSearch\"\n                prefName=\"showSearch\"\n                value={prefs.showSearch}\n                onChange={this.handlePrefChange}\n                titleString={{id: \"settings_pane_search_header\"}}\n                descString={{id: \"settings_pane_search_body\"}} />\n\n              <hr />\n\n              <PreferencesInput\n                className=\"showTopSites\"\n                prefName=\"showTopSites\"\n                value={prefs.showTopSites}\n                onChange={this.handlePrefChange}\n                titleString={{id: \"settings_pane_topsites_header\"}}\n                descString={{id: \"settings_pane_topsites_body\"}}>\n\n                <PreferencesInput\n                  className=\"showMoreTopSites\"\n                  prefName=\"topSitesRows\"\n                  disabled={!prefs.showTopSites}\n                  value={prefs.topSitesRows === 2}\n                  onChange={this.handlePrefChange}\n                  titleString={{id: \"settings_pane_topsites_options_showmore\"}}\n                  labelClassName=\"icon icon-topsites\" />\n              </PreferencesInput>\n\n              {sections\n                .filter(section => !section.shouldHidePref)\n                .map(({id, title, enabled, pref}) =>\n                  (<PreferencesInput\n                    key={id}\n                    className=\"showSection\"\n                    prefName={(pref && pref.feed) || id}\n                    value={enabled}\n                    onChange={(pref && pref.feed) ? this.handlePrefChange : this.handleSectionChange}\n                    titleString={(pref && pref.titleString) || title}\n                    descString={pref && pref.descString}>\n\n                    {pref && pref.nestedPrefs && pref.nestedPrefs.map(nestedPref =>\n                      (<PreferencesInput\n                        key={nestedPref.name}\n                        prefName={nestedPref.name}\n                        disabled={!enabled}\n                        value={prefs[nestedPref.name]}\n                        onChange={this.handlePrefChange}\n                        titleString={nestedPref.titleString}\n                        labelClassName={`icon ${nestedPref.icon}`} />)\n                    )}\n                   </PreferencesInput>)\n                )}\n              {!prefs.disableSnippets && <hr />}\n\n              {!prefs.disableSnippets && <PreferencesInput className=\"showSnippets\" prefName=\"feeds.snippets\"\n                value={prefs[\"feeds.snippets\"]} onChange={this.handlePrefChange}\n                titleString={{id: \"settings_pane_snippets_header\"}}\n                descString={{id: \"settings_pane_snippets_body\"}} />}\n\n            </div>\n            <section className=\"actions\">\n              <button className=\"done\" onClick={this.togglePane}>\n                <FormattedMessage id=\"settings_pane_done_button\" />\n              </button>\n            </section>\n          </div>\n        </div>\n      </div>);\n  }\n}\n\nexport const PreferencesPane = connect(state => ({\n  Prefs: state.Prefs,\n  PreferencesPane: state.PreferencesPane,\n  Sections: state.Sections\n}))(injectIntl(_PreferencesPane));\n\n\n\n// WEBPACK FOOTER //\n// ./system-addon/content-src/components/PreferencesPane/PreferencesPane.jsx","class _PrerenderData {\n  constructor(options) {\n    this.initialPrefs = options.initialPrefs;\n    this.initialSections = options.initialSections;\n    this._setValidation(options.validation);\n  }\n\n  get validation() {\n    return this._validation;\n  }\n\n  set validation(value) {\n    this._setValidation(value);\n  }\n\n  get invalidatingPrefs() {\n    return this._invalidatingPrefs;\n  }\n\n    // This is needed so we can use it in the constructor\n  _setValidation(value = []) {\n    this._validation = value;\n    this._invalidatingPrefs = value.reduce((result, next) => {\n      if (typeof next === \"string\") {\n        result.push(next);\n        return result;\n      } else if (next && next.oneOf) {\n        return result.concat(next.oneOf);\n      }\n      throw new Error(\"Your validation configuration is not properly configured\");\n    }, []);\n  }\n\n  arePrefsValid(getPref) {\n    for (const prefs of this.validation) {\n      // {oneOf: [\"foo\", \"bar\"]}\n      if (prefs && prefs.oneOf && !prefs.oneOf.some(name => getPref(name) === this.initialPrefs[name])) {\n        return false;\n\n      // \"foo\"\n      } else if (getPref(prefs) !== this.initialPrefs[prefs]) {\n        return false;\n      }\n    }\n    return true;\n  }\n}\n\nthis.PrerenderData = new _PrerenderData({\n  initialPrefs: {\n    \"migrationExpired\": true,\n    \"showTopSites\": true,\n    \"showSearch\": true,\n    \"topSitesRows\": 1,\n    \"collapseTopSites\": false,\n    \"section.highlights.collapsed\": false,\n    \"section.topstories.collapsed\": false,\n    \"feeds.section.topstories\": true,\n    \"feeds.section.highlights\": true\n  },\n  // Prefs listed as invalidating will prevent the prerendered version\n  // of AS from being used if their value is something other than what is listed\n  // here. This is required because some preferences cause the page layout to be\n  // too different for the prerendered version to be used. Unfortunately, this\n  // will result in users who have modified some of their preferences not being\n  // able to get the benefits of prerendering.\n  validation: [\n    \"showTopSites\",\n    \"showSearch\",\n    \"topSitesRows\",\n    \"collapseTopSites\",\n    \"section.highlights.collapsed\",\n    \"section.topstories.collapsed\",\n    // This means if either of these are set to their default values,\n    // prerendering can be used.\n    {oneOf: [\"feeds.section.topstories\", \"feeds.section.highlights\"]}\n  ],\n  initialSections: [\n    {\n      enabled: true,\n      icon: \"pocket\",\n      id: \"topstories\",\n      order: 1,\n      title: {id: \"header_recommended_by\", values: {provider: \"Pocket\"}}\n    },\n    {\n      enabled: true,\n      id: \"highlights\",\n      icon: \"highlights\",\n      order: 2,\n      title: {id: \"header_highlights\"}\n    }\n  ]\n});\n\nthis._PrerenderData = _PrerenderData;\nthis.EXPORTED_SYMBOLS = [\"PrerenderData\", \"_PrerenderData\"];\n\n\n\n// WEBPACK FOOTER //\n// ./system-addon/common/PrerenderData.jsm","/* globals ContentSearchUIController */\n\"use strict\";\n\nimport {FormattedMessage, injectIntl} from \"react-intl\";\nimport {actionCreators as ac} from \"common/Actions.jsm\";\nimport {connect} from \"react-redux\";\nimport {IS_NEWTAB} from \"content-src/lib/constants\";\nimport React from \"react\";\n\nexport class _Search extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.onClick = this.onClick.bind(this);\n    this.onInputMount = this.onInputMount.bind(this);\n  }\n\n  handleEvent(event) {\n    // Also track search events with our own telemetry\n    if (event.detail.type === \"Search\") {\n      this.props.dispatch(ac.UserEvent({event: \"SEARCH\"}));\n    }\n  }\n\n  onClick(event) {\n    window.gContentSearchController.search(event);\n  }\n\n  componentWillUnmount() {\n    delete window.gContentSearchController;\n  }\n\n  onInputMount(input) {\n    if (input) {\n      // The \"healthReportKey\" and needs to be \"newtab\" or \"abouthome\" so that\n      // BrowserUsageTelemetry.jsm knows to handle events with this name, and\n      // can add the appropriate telemetry probes for search. Without the correct\n      // name, certain tests like browser_UsageTelemetry_content.js will fail\n      // (See github ticket #2348 for more details)\n      const healthReportKey = IS_NEWTAB ? \"newtab\" : \"abouthome\";\n\n      // The \"searchSource\" needs to be \"newtab\" or \"homepage\" and is sent with\n      // the search data and acts as context for the search request (See\n      // nsISearchEngine.getSubmission). It is necessary so that search engine\n      // plugins can correctly atribute referrals. (See github ticket #3321 for\n      // more details)\n      const searchSource = IS_NEWTAB ? \"newtab\" : \"homepage\";\n\n      // gContentSearchController needs to exist as a global so that tests for\n      // the existing about:home can find it; and so it allows these tests to pass.\n      // In the future, when activity stream is default about:home, this can be renamed\n      window.gContentSearchController = new ContentSearchUIController(input, input.parentNode,\n        healthReportKey, searchSource);\n      addEventListener(\"ContentSearchClient\", this);\n    } else {\n      window.gContentSearchController = null;\n      removeEventListener(\"ContentSearchClient\", this);\n    }\n  }\n\n  /*\n   * Do not change the ID on the input field, as legacy newtab code\n   * specifically looks for the id 'newtab-search-text' on input fields\n   * in order to execute searches in various tests\n   */\n  render() {\n    return (<div className=\"search-wrapper\">\n      <label htmlFor=\"newtab-search-text\" className=\"search-label\">\n        <span className=\"sr-only\"><FormattedMessage id=\"search_web_placeholder\" /></span>\n      </label>\n      <input\n        id=\"newtab-search-text\"\n        maxLength=\"256\"\n        placeholder={this.props.intl.formatMessage({id: \"search_web_placeholder\"})}\n        ref={this.onInputMount}\n        title={this.props.intl.formatMessage({id: \"search_web_placeholder\"})}\n        type=\"search\" />\n      <button\n        id=\"searchSubmit\"\n        className=\"search-button\"\n        onClick={this.onClick}\n        title={this.props.intl.formatMessage({id: \"search_button\"})}>\n        <span className=\"sr-only\"><FormattedMessage id=\"search_button\" /></span>\n      </button>\n    </div>);\n  }\n}\n\nexport const Search = connect()(injectIntl(_Search));\n\n\n\n// WEBPACK FOOTER //\n// ./system-addon/content-src/components/Search/Search.jsx","import {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\nimport {addLocaleData, IntlProvider} from \"react-intl\";\nimport {ConfirmDialog} from \"content-src/components/ConfirmDialog/ConfirmDialog\";\nimport {connect} from \"react-redux\";\nimport {ErrorBoundary} from \"content-src/components/ErrorBoundary/ErrorBoundary\";\nimport {ManualMigration} from \"content-src/components/ManualMigration/ManualMigration\";\nimport {PreferencesPane} from \"content-src/components/PreferencesPane/PreferencesPane\";\nimport {PrerenderData} from \"common/PrerenderData.jsm\";\nimport React from \"react\";\nimport {Search} from \"content-src/components/Search/Search\";\nimport {Sections} from \"content-src/components/Sections/Sections\";\nimport {TopSites} from \"content-src/components/TopSites/TopSites\";\n\n// Add the locale data for pluralization and relative-time formatting for now,\n// this just uses english locale data. We can make this more sophisticated if\n// more features are needed.\nfunction addLocaleDataForReactIntl(locale) {\n  addLocaleData([{locale, parentLocale: \"en\"}]);\n}\n\nexport class _Base extends React.PureComponent {\n  componentWillMount() {\n    const {App, locale} = this.props;\n    this.sendNewTabRehydrated(App);\n    addLocaleDataForReactIntl(locale);\n  }\n\n  componentDidMount() {\n    // Request state AFTER the first render to ensure we don't cause the\n    // prerendered DOM to be unmounted. Otherwise, NEW_TAB_STATE_REQUEST is\n    // dispatched right after the store is ready.\n    if (this.props.isPrerendered) {\n      this.props.dispatch(ac.AlsoToMain({type: at.NEW_TAB_STATE_REQUEST}));\n      this.props.dispatch(ac.AlsoToMain({type: at.PAGE_PRERENDERED}));\n    }\n  }\n\n  componentWillUpdate({App}) {\n    this.sendNewTabRehydrated(App);\n  }\n\n  // The NEW_TAB_REHYDRATED event is used to inform feeds that their\n  // data has been consumed e.g. for counting the number of tabs that\n  // have rendered that data.\n  sendNewTabRehydrated(App) {\n    if (App && App.initialized && !this.renderNotified) {\n      this.props.dispatch(ac.AlsoToMain({type: at.NEW_TAB_REHYDRATED, data: {}}));\n      this.renderNotified = true;\n    }\n  }\n\n  render() {\n    const {props} = this;\n    const {App, locale, strings} = props;\n    const {initialized} = App;\n\n    if (!props.isPrerendered && !initialized) {\n      return null;\n    }\n\n    return (<IntlProvider locale={locale} messages={strings}>\n        <ErrorBoundary className=\"base-content-fallback\">\n          <BaseContent {...this.props} />\n        </ErrorBoundary>\n      </IntlProvider>);\n  }\n}\n\nexport class BaseContent extends React.PureComponent {\n  render() {\n    const {props} = this;\n    const {App} = props;\n    const {initialized} = App;\n    const prefs = props.Prefs.values;\n\n    const shouldBeFixedToTop = PrerenderData.arePrefsValid(name => prefs[name]);\n\n    const outerClassName = `outer-wrapper${shouldBeFixedToTop ? \" fixed-to-top\" : \"\"} ${prefs.enableWideLayout ? \"wide-layout-enabled\" : \"wide-layout-disabled\"}`;\n\n    return (\n        <div className={outerClassName}>\n          <main>\n            {prefs.showSearch &&\n              <ErrorBoundary>\n                <Search />\n              </ErrorBoundary>}\n            <div className={`body-wrapper${(initialized ? \" on\" : \"\")}`}>\n              {!prefs.migrationExpired && <ManualMigration />}\n              {prefs.showTopSites && <TopSites />}\n              <Sections />\n            </div>\n            <ConfirmDialog />\n          </main>\n          {initialized &&\n            <div className=\"prefs-pane\">\n              <ErrorBoundary className=\"sidebar\"> <PreferencesPane /> </ErrorBoundary>\n            </div>\n          }\n        </div>);\n  }\n}\n\nexport const Base = connect(state => ({App: state.App, Prefs: state.Prefs}))(_Base);\n\n\n\n// WEBPACK FOOTER //\n// ./system-addon/content-src/components/Base/Base.jsx","export const IS_NEWTAB = global.document && global.document.documentURI === \"about:newtab\";\n\n\n\n// WEBPACK FOOTER //\n// ./system-addon/content-src/lib/constants.js","import {Card, PlaceholderCard} from \"content-src/components/Card/Card\";\nimport {FormattedMessage, injectIntl} from \"react-intl\";\nimport {actionCreators as ac} from \"common/Actions.jsm\";\nimport {CollapsibleSection} from \"content-src/components/CollapsibleSection/CollapsibleSection\";\nimport {ComponentPerfTimer} from \"content-src/components/ComponentPerfTimer/ComponentPerfTimer\";\nimport {connect} from \"react-redux\";\nimport React from \"react\";\nimport {Topics} from \"content-src/components/Topics/Topics\";\n\nconst VISIBLE = \"visible\";\nconst VISIBILITY_CHANGE_EVENT = \"visibilitychange\";\nconst CARDS_PER_ROW = 3;\n\nfunction getFormattedMessage(message) {\n  return typeof message === \"string\" ? <span>{message}</span> : <FormattedMessage {...message} />;\n}\n\nexport class Section extends React.PureComponent {\n  _dispatchImpressionStats() {\n    const {props} = this;\n    const maxCards = 3 * props.maxRows;\n    const cards = props.rows.slice(0, maxCards);\n\n    if (this.needsImpressionStats(cards)) {\n      props.dispatch(ac.ImpressionStats({\n        source: props.eventSource,\n        tiles: cards.map(link => ({id: link.guid}))\n      }));\n      this.impressionCardGuids = cards.map(link => link.guid);\n    }\n  }\n\n  // This sends an event when a user sees a set of new content. If content\n  // changes while the page is hidden (i.e. preloaded or on a hidden tab),\n  // only send the event if the page becomes visible again.\n  sendImpressionStatsOrAddListener() {\n    const {props} = this;\n\n    if (!props.shouldSendImpressionStats || !props.dispatch) {\n      return;\n    }\n\n    if (props.document.visibilityState === VISIBLE) {\n      this._dispatchImpressionStats();\n    } else {\n      // We should only ever send the latest impression stats ping, so remove any\n      // older listeners.\n      if (this._onVisibilityChange) {\n        props.document.removeEventListener(VISIBILITY_CHANGE_EVENT, this._onVisibilityChange);\n      }\n\n      // When the page becoems visible, send the impression stats ping if the section isn't collapsed.\n      this._onVisibilityChange = () => {\n        if (props.document.visibilityState === VISIBLE) {\n          const {id, Prefs} = this.props;\n          const isCollapsed = Prefs.values[`section.${id}.collapsed`];\n          if (!isCollapsed) {\n            this._dispatchImpressionStats();\n          }\n          props.document.removeEventListener(VISIBILITY_CHANGE_EVENT, this._onVisibilityChange);\n        }\n      };\n      props.document.addEventListener(VISIBILITY_CHANGE_EVENT, this._onVisibilityChange);\n    }\n  }\n\n  componentDidMount() {\n    const {id, rows, Prefs} = this.props;\n    const isCollapsed = Prefs.values[`section.${id}.collapsed`];\n    if (rows.length && !isCollapsed) {\n      this.sendImpressionStatsOrAddListener();\n    }\n  }\n\n  componentDidUpdate(prevProps) {\n    const {props} = this;\n    const {id, Prefs} = props;\n    const isCollapsedPref = `section.${id}.collapsed`;\n    const isCollapsed = Prefs.values[isCollapsedPref];\n    const wasCollapsed = prevProps.Prefs.values[isCollapsedPref];\n    if (\n      // Don't send impression stats for the empty state\n      props.rows.length &&\n      (\n        // We only want to send impression stats if the content of the cards has changed\n        // and the section is not collapsed...\n        (props.rows !== prevProps.rows && !isCollapsed) ||\n        // or if we are expanding a section that was collapsed.\n        (wasCollapsed && !isCollapsed)\n      )\n    ) {\n      this.sendImpressionStatsOrAddListener();\n    }\n  }\n\n  needsImpressionStats(cards) {\n    if (!this.impressionCardGuids || (this.impressionCardGuids.length !== cards.length)) {\n      return true;\n    }\n\n    for (let i = 0; i < cards.length; i++) {\n      if (cards[i].guid !== this.impressionCardGuids[i]) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  numberOfPlaceholders(items) {\n    if (items === 0) {\n      return CARDS_PER_ROW;\n    }\n    const remainder = items % CARDS_PER_ROW;\n    if (remainder === 0) {\n      return 0;\n    }\n    return CARDS_PER_ROW - remainder;\n  }\n\n  render() {\n    const {\n      id, eventSource, title, icon, rows,\n      infoOption, emptyState, dispatch, maxRows,\n      contextMenuOptions, initialized, disclaimer\n    } = this.props;\n    const maxCards = CARDS_PER_ROW * maxRows;\n\n    // Show topics only for top stories and if it's not initialized yet (so\n    // content doesn't shift when it is loaded) or has loaded with topics\n    const shouldShowTopics = (id === \"topstories\" &&\n      (!this.props.topics || this.props.topics.length > 0));\n\n    const realRows = rows.slice(0, maxCards);\n    const placeholders = this.numberOfPlaceholders(realRows.length);\n\n    // The empty state should only be shown after we have initialized and there is no content.\n    // Otherwise, we should show placeholders.\n    const shouldShowEmptyState = initialized && !rows.length;\n\n    // <Section> <-- React component\n    // <section> <-- HTML5 element\n    return (<ComponentPerfTimer {...this.props}>\n      <CollapsibleSection className=\"section\" icon={icon} title={getFormattedMessage(title)}\n        infoOption={infoOption}\n        id={id}\n        eventSource={eventSource}\n        disclaimer={disclaimer}\n        prefName={`section.${id}.collapsed`}\n        Prefs={this.props.Prefs}\n        dispatch={this.props.dispatch}>\n\n        {!shouldShowEmptyState && (<ul className=\"section-list\" style={{padding: 0}}>\n          {realRows.map((link, index) => link &&\n            <Card key={index} index={index} dispatch={dispatch} link={link} contextMenuOptions={contextMenuOptions}\n              eventSource={eventSource} shouldSendImpressionStats={this.props.shouldSendImpressionStats} isWebExtension={this.props.isWebExtension} />)}\n          {placeholders > 0 && [...new Array(placeholders)].map((_, i) => <PlaceholderCard key={i} />)}\n        </ul>)}\n        {shouldShowEmptyState &&\n          <div className=\"section-empty-state\">\n            <div className=\"empty-state\">\n              {emptyState.icon && emptyState.icon.startsWith(\"moz-extension://\") ?\n                <img className=\"empty-state-icon icon\" style={{\"background-image\": `url('${emptyState.icon}')`}} /> :\n                <img className={`empty-state-icon icon icon-${emptyState.icon}`} />}\n              <p className=\"empty-state-message\">\n                {getFormattedMessage(emptyState.message)}\n              </p>\n            </div>\n          </div>}\n        {shouldShowTopics && <Topics topics={this.props.topics} read_more_endpoint={this.props.read_more_endpoint} />}\n      </CollapsibleSection>\n    </ComponentPerfTimer>);\n  }\n}\n\nSection.defaultProps = {\n  document: global.document,\n  rows: [],\n  emptyState: {},\n  title: \"\"\n};\n\nexport const SectionIntl = injectIntl(Section);\n\nexport class _Sections extends React.PureComponent {\n  render() {\n    const sections = this.props.Sections;\n    return (\n      <div className=\"sections-list\">\n        {sections\n          .filter(section => section.enabled)\n          .map(section => <SectionIntl key={section.id} {...section} Prefs={this.props.Prefs} dispatch={this.props.dispatch} />)}\n      </div>\n    );\n  }\n}\n\nexport const Sections = connect(state => ({Sections: state.Sections, Prefs: state.Prefs}))(_Sections);\n\n\n\n// WEBPACK FOOTER //\n// ./system-addon/content-src/components/Sections/Sections.jsx","export const cardContextTypes = {\n  history: {\n    intlID: \"type_label_visited\",\n    icon: \"historyItem\"\n  },\n  bookmark: {\n    intlID: \"type_label_bookmarked\",\n    icon: \"bookmark-added\"\n  },\n  trending: {\n    intlID: \"type_label_recommended\",\n    icon: \"trending\"\n  },\n  now: {\n    intlID: \"type_label_now\",\n    icon: \"now\"\n  }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./system-addon/content-src/components/Card/types.js","import {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\nimport {cardContextTypes} from \"./types\";\nimport {FormattedMessage} from \"react-intl\";\nimport {LinkMenu} from \"content-src/components/LinkMenu/LinkMenu\";\nimport React from \"react\";\n\n// Keep track of pending image loads to only request once\nconst gImageLoading = new Map();\n\n/**\n * Card component.\n * Cards are found within a Section component and contain information about a link such\n * as preview image, page title, page description, and some context about if the page\n * was visited, bookmarked, trending etc...\n * Each Section can make an unordered list of Cards which will create one instane of\n * this class. Each card will then get a context menu which reflects the actions that\n * can be done on this Card.\n */\nexport class Card extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      activeCard: null,\n      imageLoaded: false,\n      showContextMenu: false\n    };\n    this.onMenuButtonClick = this.onMenuButtonClick.bind(this);\n    this.onMenuUpdate = this.onMenuUpdate.bind(this);\n    this.onLinkClick = this.onLinkClick.bind(this);\n  }\n\n  /**\n   * Helper to conditionally load an image and update state when it loads.\n   */\n  async maybeLoadImage() {\n    // No need to load if it's already loaded or no image\n    const {image} = this.props.link;\n    if (!this.state.imageLoaded && image) {\n      // Initialize a promise to share a load across multiple card updates\n      if (!gImageLoading.has(image)) {\n        const loaderPromise = new Promise((resolve, reject) => {\n          const loader = new Image();\n          loader.addEventListener(\"load\", resolve);\n          loader.addEventListener(\"error\", reject);\n          loader.src = image;\n        });\n\n        // Save and remove the promise only while it's pending\n        gImageLoading.set(image, loaderPromise);\n        loaderPromise.catch(ex => ex).then(() => gImageLoading.delete(image)).catch();\n      }\n\n      // Wait for the image whether just started loading or reused promise\n      await gImageLoading.get(image);\n\n      // Only update state if we're still waiting to load the original image\n      if (this.props.link.image === image && !this.state.imageLoaded) {\n        this.setState({imageLoaded: true});\n      }\n    }\n  }\n\n  onMenuButtonClick(event) {\n    event.preventDefault();\n    this.setState({\n      activeCard: this.props.index,\n      showContextMenu: true\n    });\n  }\n\n  onLinkClick(event) {\n    event.preventDefault();\n    const {altKey, button, ctrlKey, metaKey, shiftKey} = event;\n    this.props.dispatch(ac.AlsoToMain({\n      type: at.OPEN_LINK,\n      data: Object.assign(this.props.link, {event: {altKey, button, ctrlKey, metaKey, shiftKey}})\n    }));\n\n    if (this.props.isWebExtension) {\n      this.props.dispatch(ac.WebExtEvent(at.WEBEXT_CLICK, {\n        source: this.props.eventSource,\n        url: this.props.link.url,\n        action_position: this.props.index\n      }));\n    } else {\n      this.props.dispatch(ac.UserEvent({\n        event: \"CLICK\",\n        source: this.props.eventSource,\n        action_position: this.props.index\n      }));\n\n      if (this.props.shouldSendImpressionStats) {\n        this.props.dispatch(ac.ImpressionStats({\n          source: this.props.eventSource,\n          click: 0,\n          tiles: [{id: this.props.link.guid, pos: this.props.index}]\n        }));\n      }\n    }\n  }\n\n  onMenuUpdate(showContextMenu) {\n    this.setState({showContextMenu});\n  }\n\n  componentDidMount() {\n    this.maybeLoadImage();\n  }\n\n  componentDidUpdate() {\n    this.maybeLoadImage();\n  }\n\n  componentWillReceiveProps(nextProps) {\n    // Clear the image state if changing images\n    if (nextProps.link.image !== this.props.link.image) {\n      this.setState({imageLoaded: false});\n    }\n  }\n\n  render() {\n    const {index, link, dispatch, contextMenuOptions, eventSource, shouldSendImpressionStats} = this.props;\n    const {props} = this;\n    const isContextMenuOpen = this.state.showContextMenu && this.state.activeCard === index;\n    // Display \"now\" as \"trending\" until we have new strings #3402\n    const {icon, intlID} = cardContextTypes[link.type === \"now\" ? \"trending\" : link.type] || {};\n    const hasImage = link.image || link.hasImage;\n    const imageStyle = {backgroundImage: link.image ? `url(${link.image})` : \"none\"};\n\n    return (<li className={`card-outer${isContextMenuOpen ? \" active\" : \"\"}${props.placeholder ? \" placeholder\" : \"\"}`}>\n      <a href={link.url} onClick={!props.placeholder ? this.onLinkClick : undefined}>\n        <div className=\"card\">\n          {hasImage && <div className=\"card-preview-image-outer\">\n            <div className={`card-preview-image${this.state.imageLoaded ? \" loaded\" : \"\"}`} style={imageStyle} />\n          </div>}\n          <div className={`card-details${hasImage ? \"\" : \" no-image\"}`}>\n            {link.hostname && <div className=\"card-host-name\">{link.hostname}</div>}\n            <div className={[\n              \"card-text\",\n              icon ? \"\" : \"no-context\",\n              link.description ? \"\" : \"no-description\",\n              link.hostname ? \"\" : \"no-host-name\",\n              hasImage ? \"\" : \"no-image\"\n            ].join(\" \")}>\n              <h4 className=\"card-title\" dir=\"auto\">{link.title}</h4>\n              <p className=\"card-description\" dir=\"auto\">{link.description}</p>\n            </div>\n            <div className=\"card-context\">\n              {icon && !link.context && <span className={`card-context-icon icon icon-${icon}`} />}\n              {link.icon && link.context && <span className=\"card-context-icon icon\" style={{backgroundImage: `url('${link.icon}')`}} />}\n              {intlID && !link.context && <div className=\"card-context-label\"><FormattedMessage id={intlID} defaultMessage=\"Visited\" /></div>}\n              {link.context && <div className=\"card-context-label\">{link.context}</div>}\n            </div>\n          </div>\n        </div>\n      </a>\n      {!props.placeholder && <button className=\"context-menu-button icon\"\n        onClick={this.onMenuButtonClick}>\n        <span className=\"sr-only\">{`Open context menu for ${link.title}`}</span>\n      </button>}\n      {!props.placeholder && <LinkMenu\n        dispatch={dispatch}\n        index={index}\n        source={eventSource}\n        onUpdate={this.onMenuUpdate}\n        options={link.contextMenuOptions || contextMenuOptions}\n        site={link}\n        visible={isContextMenuOpen}\n        shouldSendImpressionStats={shouldSendImpressionStats} />}\n   </li>);\n  }\n}\nCard.defaultProps = {link: {}};\n\nexport const PlaceholderCard = () => <Card placeholder={true} />;\n\n\n\n// WEBPACK FOOTER //\n// ./system-addon/content-src/components/Card/Card.jsx","import {FormattedMessage} from \"react-intl\";\nimport React from \"react\";\n\nexport class Topic extends React.PureComponent {\n  render() {\n    const {url, name} = this.props;\n    return (<li><a key={name} className=\"topic-link\" href={url}>{name}</a></li>);\n  }\n}\n\nexport class Topics extends React.PureComponent {\n  render() {\n    const {topics, read_more_endpoint} = this.props;\n    return (\n      <div className=\"topic\">\n        <span><FormattedMessage id=\"pocket_read_more\" /></span>\n        <ul>{topics && topics.map(t => <Topic key={t.name} url={t.url} name={t.name} />)}</ul>\n\n        {read_more_endpoint && <a className=\"topic-read-more\" href={read_more_endpoint}>\n          <FormattedMessage id=\"pocket_read_even_more\" />\n        </a>}\n      </div>\n    );\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./system-addon/content-src/components/Topics/Topics.jsx","import {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\nimport {FormattedMessage, injectIntl} from \"react-intl\";\nimport {MIN_CORNER_FAVICON_SIZE, MIN_RICH_FAVICON_SIZE, TOP_SITES_SOURCE} from \"./TopSitesConstants\";\nimport {CollapsibleSection} from \"content-src/components/CollapsibleSection/CollapsibleSection\";\nimport {ComponentPerfTimer} from \"content-src/components/ComponentPerfTimer/ComponentPerfTimer\";\nimport {connect} from \"react-redux\";\nimport React from \"react\";\nimport {TOP_SITES_MAX_SITES_PER_ROW} from \"common/Reducers.jsm\";\nimport {TopSiteForm} from \"./TopSiteForm\";\nimport {TopSiteList} from \"./TopSite\";\n\n/**\n * Iterates through TopSites and counts types of images.\n * @param acc Accumulator for reducer.\n * @param topsite Entry in TopSites.\n */\nfunction countTopSitesIconsTypes(topSites) {\n  const countTopSitesTypes = (acc, link) => {\n    if (link.tippyTopIcon || link.faviconRef === \"tippytop\") {\n      acc.tippytop++;\n    } else if (link.faviconSize >= MIN_RICH_FAVICON_SIZE) {\n      acc.rich_icon++;\n    } else if (link.screenshot && link.faviconSize >= MIN_CORNER_FAVICON_SIZE) {\n      acc.screenshot_with_icon++;\n    } else if (link.screenshot) {\n      acc.screenshot++;\n    } else {\n      acc.no_image++;\n    }\n\n    return acc;\n  };\n\n  return topSites.reduce(countTopSitesTypes, {\n    \"screenshot_with_icon\": 0,\n    \"screenshot\": 0,\n    \"tippytop\": 0,\n    \"rich_icon\": 0,\n    \"no_image\": 0\n  });\n}\n\nexport class _TopSites extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.onAddButtonClick = this.onAddButtonClick.bind(this);\n    this.onFormClose = this.onFormClose.bind(this);\n  }\n\n  /**\n   * Dispatch session statistics about the quality of TopSites icons and pinned count.\n   */\n  _dispatchTopSitesStats() {\n    const topSites = this._getVisibleTopSites();\n    const topSitesIconsStats = countTopSitesIconsTypes(topSites);\n    const topSitesPinned = topSites.filter(site => !!site.isPinned).length;\n    // Dispatch telemetry event with the count of TopSites images types.\n    this.props.dispatch(ac.AlsoToMain({\n      type: at.SAVE_SESSION_PERF_DATA,\n      data: {topsites_icon_stats: topSitesIconsStats, topsites_pinned: topSitesPinned}\n    }));\n  }\n\n  /**\n   * Return the TopSites that are visible based on prefs and window width.\n   */\n  _getVisibleTopSites() {\n    // We hide 2 sites per row when not in the wide layout.\n    let sitesPerRow = TOP_SITES_MAX_SITES_PER_ROW;\n    // $break-point-widest = 1072px (from _variables.scss)\n    if (!global.matchMedia(`(min-width: 1072px)`).matches) {\n      sitesPerRow -= 2;\n    }\n    return this.props.TopSites.rows.slice(0, this.props.TopSitesRows * sitesPerRow);\n  }\n\n  componentDidUpdate() {\n    this._dispatchTopSitesStats();\n  }\n\n  componentDidMount() {\n    this._dispatchTopSitesStats();\n  }\n\n  onAddButtonClick() {\n    this.props.dispatch(ac.UserEvent({\n      source: TOP_SITES_SOURCE,\n      event: \"TOP_SITES_ADD_FORM_OPEN\"\n    }));\n    // Negative index will prepend the TopSite at the beginning of the list\n    this.props.dispatch({type: at.TOP_SITES_EDIT, data: {index: -1}});\n  }\n\n  onFormClose() {\n    this.props.dispatch(ac.UserEvent({\n      source: TOP_SITES_SOURCE,\n      event: \"TOP_SITES_EDIT_CLOSE\"\n    }));\n    this.props.dispatch({type: at.TOP_SITES_CANCEL_EDIT});\n  }\n\n  render() {\n    const {props} = this;\n    const infoOption = {\n      header: {id: \"settings_pane_topsites_header\"},\n      body: {id: \"settings_pane_topsites_body\"}\n    };\n    const {editForm} = props.TopSites;\n\n    return (<ComponentPerfTimer id=\"topsites\" initialized={props.TopSites.initialized} dispatch={props.dispatch}>\n      <CollapsibleSection className=\"top-sites\" icon=\"topsites\" title={<FormattedMessage id=\"header_top_sites\" />} infoOption={infoOption} prefName=\"collapseTopSites\" Prefs={props.Prefs} dispatch={props.dispatch}>\n        <TopSiteList TopSites={props.TopSites} TopSitesRows={props.TopSitesRows} dispatch={props.dispatch} intl={props.intl} />\n        <div className=\"edit-topsites-wrapper\">\n          <div className=\"add-topsites-button\">\n            <button\n              className=\"add\"\n              title={this.props.intl.formatMessage({id: \"edit_topsites_add_button_tooltip\"})}\n              onClick={this.onAddButtonClick}>\n              <FormattedMessage id=\"edit_topsites_add_button\" />\n            </button>\n          </div>\n          {editForm &&\n            <div className=\"edit-topsites\">\n              <div className=\"modal-overlay\" onClick={this.onFormClose} />\n              <div className=\"modal\">\n                <TopSiteForm\n                  site={props.TopSites.rows[editForm.index]}\n                  index={editForm.index}\n                  onClose={this.onFormClose}\n                  dispatch={this.props.dispatch}\n                  intl={this.props.intl} />\n              </div>\n            </div>\n          }\n        </div>\n      </CollapsibleSection>\n    </ComponentPerfTimer>);\n  }\n}\n\nexport const TopSites = connect(state => ({\n  TopSites: state.TopSites,\n  Prefs: state.Prefs,\n  TopSitesRows: state.Prefs.values.topSitesRows\n}))(injectIntl(_TopSites));\n\n\n\n// WEBPACK FOOTER //\n// ./system-addon/content-src/components/TopSites/TopSites.jsx","import {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\nimport {FormattedMessage} from \"react-intl\";\nimport React from \"react\";\nimport {TOP_SITES_SOURCE} from \"./TopSitesConstants\";\n\nexport class TopSiteForm extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    const {site} = props;\n    this.state = {\n      label: site ? (site.label || site.hostname) : \"\",\n      url: site ? site.url : \"\",\n      validationError: false\n    };\n    this.onLabelChange = this.onLabelChange.bind(this);\n    this.onUrlChange = this.onUrlChange.bind(this);\n    this.onCancelButtonClick = this.onCancelButtonClick.bind(this);\n    this.onDoneButtonClick = this.onDoneButtonClick.bind(this);\n    this.onUrlInputMount = this.onUrlInputMount.bind(this);\n  }\n\n  onLabelChange(event) {\n    this.resetValidation();\n    this.setState({\"label\": event.target.value});\n  }\n\n  onUrlChange(event) {\n    this.resetValidation();\n    this.setState({\"url\": event.target.value});\n  }\n\n  onCancelButtonClick(ev) {\n    ev.preventDefault();\n    this.props.onClose();\n  }\n\n  onDoneButtonClick(ev) {\n    ev.preventDefault();\n\n    if (this.validateForm()) {\n      const site = {url: this.cleanUrl()};\n      const {index} = this.props;\n      if (this.state.label !== \"\") {\n        site.label = this.state.label;\n      }\n\n      this.props.dispatch(ac.AlsoToMain({\n        type: at.TOP_SITES_PIN,\n        data: {site, index}\n      }));\n      this.props.dispatch(ac.UserEvent({\n        source: TOP_SITES_SOURCE,\n        event: \"TOP_SITES_EDIT\",\n        action_position: index\n      }));\n\n      this.props.onClose();\n    }\n  }\n\n  cleanUrl() {\n    let {url} = this.state;\n    // If we are missing a protocol, prepend http://\n    if (!url.startsWith(\"http:\") && !url.startsWith(\"https:\")) {\n      url = `http://${url}`;\n    }\n    return url;\n  }\n\n  resetValidation() {\n    if (this.state.validationError) {\n      this.setState({validationError: false});\n    }\n  }\n\n  validateUrl() {\n    try {\n      return !!new URL(this.cleanUrl());\n    } catch (e) {\n      return false;\n    }\n  }\n\n  validateForm() {\n    this.resetValidation();\n    // Only the URL is required and must be valid.\n    if (!this.state.url || !this.validateUrl()) {\n      this.setState({validationError: true});\n      this.inputUrl.focus();\n      return false;\n    }\n    return true;\n  }\n\n  onUrlInputMount(input) {\n    this.inputUrl = input;\n  }\n\n  render() {\n    // For UI purposes, editing without an existing link is \"add\"\n    const showAsAdd = !this.props.site;\n\n    return (\n      <form className=\"topsite-form\">\n        <section className=\"edit-topsites-inner-wrapper\">\n          <div className=\"form-wrapper\">\n            <h3 className=\"section-title\">\n              <FormattedMessage id={showAsAdd ? \"topsites_form_add_header\" : \"topsites_form_edit_header\"} />\n            </h3>\n            <div className=\"field title\">\n              <input\n                type=\"text\"\n                value={this.state.label}\n                onChange={this.onLabelChange}\n                placeholder={this.props.intl.formatMessage({id: \"topsites_form_title_placeholder\"})} />\n            </div>\n            <div className={`field url${this.state.validationError ? \" invalid\" : \"\"}`}>\n              <input\n                type=\"text\"\n                ref={this.onUrlInputMount}\n                value={this.state.url}\n                onChange={this.onUrlChange}\n                placeholder={this.props.intl.formatMessage({id: \"topsites_form_url_placeholder\"})} />\n              {this.state.validationError &&\n                <aside className=\"error-tooltip\">\n                  <FormattedMessage id=\"topsites_form_url_validation\" />\n                </aside>\n              }\n            </div>\n          </div>\n        </section>\n        <section className=\"actions\">\n          <button className=\"cancel\" type=\"button\" onClick={this.onCancelButtonClick}>\n            <FormattedMessage id=\"topsites_form_cancel_button\" />\n          </button>\n          <button className=\"done\" type=\"submit\" onClick={this.onDoneButtonClick}>\n            <FormattedMessage id={showAsAdd ? \"topsites_form_add_button\" : \"topsites_form_save_button\"} />\n          </button>\n        </section>\n      </form>\n    );\n  }\n}\n\nTopSiteForm.defaultProps = {\n  TopSite: null,\n  index: -1\n};\n\n\n\n// WEBPACK FOOTER //\n// ./system-addon/content-src/components/TopSites/TopSiteForm.jsx","import {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\nimport {FormattedMessage, injectIntl} from \"react-intl\";\nimport {\n  MIN_CORNER_FAVICON_SIZE,\n  MIN_RICH_FAVICON_SIZE,\n  TOP_SITES_CONTEXT_MENU_OPTIONS,\n  TOP_SITES_SOURCE\n} from \"./TopSitesConstants\";\nimport {LinkMenu} from \"content-src/components/LinkMenu/LinkMenu\";\nimport React from \"react\";\nimport {TOP_SITES_MAX_SITES_PER_ROW} from \"common/Reducers.jsm\";\n\nexport class TopSiteLink extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.onDragEvent = this.onDragEvent.bind(this);\n  }\n\n  /*\n   * Helper to determine whether the drop zone should allow a drop. We only allow\n   * dropping top sites for now.\n   */\n  _allowDrop(e) {\n    return e.dataTransfer.types.includes(\"text/topsite-index\");\n  }\n\n  onDragEvent(event) {\n    switch (event.type) {\n      case \"click\":\n        // Stop any link clicks if we started any dragging\n        if (this.dragged) {\n          event.preventDefault();\n        }\n        break;\n      case \"dragstart\":\n        this.dragged = true;\n        event.dataTransfer.effectAllowed = \"move\";\n        event.dataTransfer.setData(\"text/topsite-index\", this.props.index);\n        event.target.blur();\n        this.props.onDragEvent(event, this.props.index, this.props.link, this.props.title);\n        break;\n      case \"dragend\":\n        this.props.onDragEvent(event);\n        break;\n      case \"dragenter\":\n      case \"dragover\":\n      case \"drop\":\n        if (this._allowDrop(event)) {\n          event.preventDefault();\n          this.props.onDragEvent(event, this.props.index);\n        }\n        break;\n      case \"mousedown\":\n        // Reset at the first mouse event of a potential drag\n        this.dragged = false;\n        break;\n    }\n  }\n\n  render() {\n    const {children, className, isDraggable, link, onClick, title} = this.props;\n    const topSiteOuterClassName = `top-site-outer${className ? ` ${className}` : \"\"}${link.isDragged ? \" dragged\" : \"\"}`;\n    const {tippyTopIcon, faviconSize} = link;\n    const [letterFallback] = title;\n    let imageClassName;\n    let imageStyle;\n    let showSmallFavicon = false;\n    let smallFaviconStyle;\n    let smallFaviconFallback;\n    if (tippyTopIcon || faviconSize >= MIN_RICH_FAVICON_SIZE) {\n      // styles and class names for top sites with rich icons\n      imageClassName = \"top-site-icon rich-icon\";\n      imageStyle = {\n        backgroundColor: link.backgroundColor,\n        backgroundImage: `url(${tippyTopIcon || link.favicon})`\n      };\n    } else {\n      // styles and class names for top sites with screenshot + small icon in top left corner\n      imageClassName = `screenshot${link.screenshot ? \" active\" : \"\"}`;\n      imageStyle = {backgroundImage: link.screenshot ? `url(${link.screenshot})` : \"none\"};\n\n      // only show a favicon in top left if it's greater than 16x16\n      if (faviconSize >= MIN_CORNER_FAVICON_SIZE) {\n        showSmallFavicon = true;\n        smallFaviconStyle = {backgroundImage:  `url(${link.favicon})`};\n      } else if (link.screenshot) {\n        // Don't show a small favicon if there is no screenshot, because that\n        // would result in two fallback icons\n        showSmallFavicon = true;\n        smallFaviconFallback = true;\n      }\n    }\n    let draggableProps = {};\n    if (isDraggable) {\n      draggableProps = {\n        onClick: this.onDragEvent,\n        onDragEnd: this.onDragEvent,\n        onDragStart: this.onDragEvent,\n        onMouseDown: this.onDragEvent\n      };\n    }\n    return (<li className={topSiteOuterClassName} onDrop={this.onDragEvent} onDragOver={this.onDragEvent} onDragEnter={this.onDragEvent} onDragLeave={this.onDragEvent} {...draggableProps}>\n      <div className=\"top-site-inner\">\n         <a href={link.url} onClick={onClick}>\n            <div className=\"tile\" aria-hidden={true} data-fallback={letterFallback}>\n              <div className={imageClassName} style={imageStyle} />\n              {showSmallFavicon && <div\n                className=\"top-site-icon default-icon\"\n                data-fallback={smallFaviconFallback && letterFallback}\n                style={smallFaviconStyle} />}\n           </div>\n           <div className={`title ${link.isPinned ? \"pinned\" : \"\"}`}>\n             {link.isPinned && <div className=\"icon icon-pin-small\" />}\n              <span dir=\"auto\">{title}</span>\n           </div>\n         </a>\n         {children}\n      </div>\n    </li>);\n  }\n}\nTopSiteLink.defaultProps = {\n  title: \"\",\n  link: {},\n  isDraggable: true\n};\n\nexport class TopSite extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {showContextMenu: false};\n    this.onLinkClick = this.onLinkClick.bind(this);\n    this.onMenuButtonClick = this.onMenuButtonClick.bind(this);\n    this.onMenuUpdate = this.onMenuUpdate.bind(this);\n  }\n\n  userEvent(event) {\n    this.props.dispatch(ac.UserEvent({\n      event,\n      source: TOP_SITES_SOURCE,\n      action_position: this.props.index\n    }));\n  }\n\n  onLinkClick(ev) {\n    this.userEvent(\"CLICK\");\n  }\n\n  onMenuButtonClick(event) {\n    event.preventDefault();\n    this.props.onActivate(this.props.index);\n    this.setState({showContextMenu: true});\n  }\n\n  onMenuUpdate(showContextMenu) {\n    this.setState({showContextMenu});\n  }\n\n  render() {\n    const {props} = this;\n    const {link} = props;\n    const isContextMenuOpen = this.state.showContextMenu && props.activeIndex === props.index;\n    const title = link.label || link.hostname;\n    return (<TopSiteLink {...props} onClick={this.onLinkClick} onDragEvent={this.props.onDragEvent} className={`${props.className || \"\"}${isContextMenuOpen ? \" active\" : \"\"}`} title={title}>\n        <div>\n          <button className=\"context-menu-button icon\" onClick={this.onMenuButtonClick}>\n            <span className=\"sr-only\">\n              <FormattedMessage id=\"context_menu_button_sr\" values={{title}} />\n            </span>\n          </button>\n          <LinkMenu\n            dispatch={props.dispatch}\n            index={props.index}\n            onUpdate={this.onMenuUpdate}\n            options={TOP_SITES_CONTEXT_MENU_OPTIONS}\n            site={link}\n            source={TOP_SITES_SOURCE}\n            visible={isContextMenuOpen} />\n        </div>\n    </TopSiteLink>);\n  }\n}\nTopSite.defaultProps = {\n  link: {},\n  onActivate() {}\n};\n\nexport class TopSitePlaceholder extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.onEditButtonClick = this.onEditButtonClick.bind(this);\n  }\n\n  onEditButtonClick() {\n    this.props.dispatch(\n      {type: at.TOP_SITES_EDIT, data: {index: this.props.index}});\n  }\n\n  render() {\n    return (<TopSiteLink {...this.props} className={`placeholder ${this.props.className || \"\"}`} isDraggable={false}>\n      <button className=\"context-menu-button edit-button icon\"\n       title={this.props.intl.formatMessage({id: \"edit_topsites_edit_button\"})}\n       onClick={this.onEditButtonClick} />\n    </TopSiteLink>);\n  }\n}\n\nexport class _TopSiteList extends React.PureComponent {\n  static get DEFAULT_STATE() {\n    return {\n      activeIndex: null,\n      draggedIndex: null,\n      draggedSite: null,\n      draggedTitle: null,\n      topSitesPreview: null\n    };\n  }\n\n  constructor(props) {\n    super(props);\n    this.state = _TopSiteList.DEFAULT_STATE;\n    this.onDragEvent = this.onDragEvent.bind(this);\n    this.onActivate = this.onActivate.bind(this);\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (this.state.draggedSite) {\n      const prevTopSites = this.props.TopSites && this.props.TopSites.rows;\n      const newTopSites = nextProps.TopSites && nextProps.TopSites.rows;\n      if (prevTopSites && prevTopSites[this.state.draggedIndex] &&\n        prevTopSites[this.state.draggedIndex].url === this.state.draggedSite.url &&\n        (!newTopSites[this.state.draggedIndex] || newTopSites[this.state.draggedIndex].url !== this.state.draggedSite.url)) {\n        // We got the new order from the redux store via props. We can clear state now.\n        this.setState(_TopSiteList.DEFAULT_STATE);\n      }\n    }\n  }\n\n  userEvent(event, index) {\n    this.props.dispatch(ac.UserEvent({\n      event,\n      source: TOP_SITES_SOURCE,\n      action_position: index\n    }));\n  }\n\n  onDragEvent(event, index, link, title) {\n    switch (event.type) {\n      case \"dragstart\":\n        this.dropped = false;\n        this.setState({\n          draggedIndex: index,\n          draggedSite: link,\n          draggedTitle: title,\n          activeIndex: null\n        });\n        this.userEvent(\"DRAG\", index);\n        break;\n      case \"dragend\":\n        if (!this.dropped) {\n          // If there was no drop event, reset the state to the default.\n          this.setState(_TopSiteList.DEFAULT_STATE);\n        }\n        break;\n      case \"dragenter\":\n        if (index === this.state.draggedIndex) {\n          this.setState({topSitesPreview: null});\n        } else {\n          this.setState({topSitesPreview: this._makeTopSitesPreview(index)});\n        }\n        break;\n      case \"drop\":\n        if (index !== this.state.draggedIndex) {\n          this.dropped = true;\n          this.props.dispatch(ac.AlsoToMain({\n            type: at.TOP_SITES_INSERT,\n            data: {site: {url: this.state.draggedSite.url, label: this.state.draggedTitle}, index, draggedFromIndex: this.state.draggedIndex}\n          }));\n          this.userEvent(\"DROP\", index);\n        }\n        break;\n    }\n  }\n\n  _getTopSites() {\n    // Make a copy of the sites to truncate or extend to desired length\n    let topSites = this.props.TopSites.rows.slice();\n    topSites.length = this.props.TopSitesRows * TOP_SITES_MAX_SITES_PER_ROW;\n    return topSites;\n  }\n\n  /**\n   * Make a preview of the topsites that will be the result of dropping the currently\n   * dragged site at the specified index.\n   */\n  _makeTopSitesPreview(index) {\n    const topSites = this._getTopSites();\n    topSites[this.state.draggedIndex] = null;\n    const pinnedOnly = topSites.map(site => ((site && site.isPinned) ? site : null));\n    const unpinned = topSites.filter(site => site && !site.isPinned);\n    const siteToInsert = Object.assign({}, this.state.draggedSite, {isPinned: true, isDragged: true});\n    if (!pinnedOnly[index]) {\n      pinnedOnly[index] = siteToInsert;\n    } else {\n      // Find the hole to shift the pinned site(s) towards. We shift towards the\n      // hole left by the site being dragged.\n      let holeIndex = index;\n      const indexStep = index > this.state.draggedIndex ? -1 : 1;\n      while (pinnedOnly[holeIndex]) {\n        holeIndex += indexStep;\n      }\n\n      // Shift towards the hole.\n      const shiftingStep = index > this.state.draggedIndex ? 1 : -1;\n      while (holeIndex !== index) {\n        const nextIndex = holeIndex + shiftingStep;\n        pinnedOnly[holeIndex] = pinnedOnly[nextIndex];\n        holeIndex = nextIndex;\n      }\n      pinnedOnly[index] = siteToInsert;\n    }\n\n    // Fill in the remaining holes with unpinned sites.\n    const preview = pinnedOnly;\n    for (let i = 0; i < preview.length; i++) {\n      if (!preview[i]) {\n        preview[i] = unpinned.shift() || null;\n      }\n    }\n\n    return preview;\n  }\n\n  onActivate(index) {\n    this.setState({activeIndex: index});\n  }\n\n  render() {\n    const {props} = this;\n    const topSites = this.state.topSitesPreview || this._getTopSites();\n    const topSitesUI = [];\n    const commonProps = {\n      onDragEvent: this.onDragEvent,\n      dispatch: props.dispatch,\n      intl: props.intl\n    };\n    // We assign a key to each placeholder slot. We need it to be independent\n    // of the slot index (i below) so that the keys used stay the same during\n    // drag and drop reordering and the underlying DOM nodes are reused.\n    // This mostly (only?) affects linux so be sure to test on linux before changing.\n    let holeIndex = 0;\n\n    // On narrow viewports, we only show 6 sites per row. We'll mark the rest as\n    // .hide-for-narrow to hide in CSS via @media query.\n    const maxNarrowVisibleIndex = props.TopSitesRows * 6;\n\n    for (let i = 0, l = topSites.length; i < l; i++) {\n      const link = topSites[i];\n      const slotProps = {\n        key: link ? link.url : holeIndex++,\n        index: i\n      };\n      if (i >= maxNarrowVisibleIndex) {\n        slotProps.className = \"hide-for-narrow\";\n      }\n      topSitesUI.push(!link ? (\n        <TopSitePlaceholder\n          {...slotProps}\n          {...commonProps} />\n      ) : (\n        <TopSite\n          link={link}\n          activeIndex={this.state.activeIndex}\n          onActivate={this.onActivate}\n          {...slotProps}\n          {...commonProps} />\n      ));\n    }\n    return (<ul className={`top-sites-list${this.state.draggedSite ? \" dnd-active\" : \"\"}`}>\n      {topSitesUI}\n    </ul>);\n  }\n}\n\nexport const TopSiteList = injectIntl(_TopSiteList);\n\n\n\n// WEBPACK FOOTER //\n// ./system-addon/content-src/components/TopSites/TopSite.jsx","import {actionCreators as ac, actionTypes as at} from \"common/Actions.jsm\";\nimport {perfService as perfSvc} from \"common/PerfService.jsm\";\n\nconst VISIBLE = \"visible\";\nconst VISIBILITY_CHANGE_EVENT = \"visibilitychange\";\n\nexport class DetectUserSessionStart {\n  constructor(store, options = {}) {\n    this._store = store;\n    // Overrides for testing\n    this.document = options.document || global.document;\n    this._perfService = options.perfService || perfSvc;\n    this._onVisibilityChange = this._onVisibilityChange.bind(this);\n  }\n\n  /**\n   * sendEventOrAddListener - Notify immediately if the page is already visible,\n   *                    or else set up a listener for when visibility changes.\n   *                    This is needed for accurate session tracking for telemetry,\n   *                    because tabs are pre-loaded.\n   */\n  sendEventOrAddListener() {\n    if (this.document.visibilityState === VISIBLE) {\n      // If the document is already visible, to the user, send a notification\n      // immediately that a session has started.\n      this._sendEvent();\n    } else {\n      // If the document is not visible, listen for when it does become visible.\n      this.document.addEventListener(VISIBILITY_CHANGE_EVENT, this._onVisibilityChange);\n    }\n  }\n\n  /**\n   * _sendEvent - Sends a message to the main process to indicate the current\n   *              tab is now visible to the user, includes the\n   *              visibility_event_rcvd_ts time in ms from the UNIX epoch.\n   */\n  _sendEvent() {\n    this._perfService.mark(\"visibility_event_rcvd_ts\");\n\n    try {\n      let visibility_event_rcvd_ts = this._perfService\n        .getMostRecentAbsMarkStartByName(\"visibility_event_rcvd_ts\");\n\n      this._store.dispatch(ac.AlsoToMain({\n        type: at.SAVE_SESSION_PERF_DATA,\n        data: {visibility_event_rcvd_ts}\n      }));\n    } catch (ex) {\n      // If this failed, it's likely because the `privacy.resistFingerprinting`\n      // pref is true.  We should at least not blow up.\n    }\n  }\n\n  /**\n   * _onVisibilityChange - If the visibility has changed to visible, sends a notification\n   *                      and removes the event listener. This should only be called once per tab.\n   */\n  _onVisibilityChange() {\n    if (this.document.visibilityState === VISIBLE) {\n      this._sendEvent();\n      this.document.removeEventListener(VISIBILITY_CHANGE_EVENT, this._onVisibilityChange);\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./system-addon/content-src/lib/detect-user-session-start.js","/* eslint-env mozilla/frame-script */\n\nimport {actionCreators as ac, actionTypes as at, actionUtils as au} from \"common/Actions.jsm\";\nimport {applyMiddleware, combineReducers, createStore} from \"redux\";\n\nexport const MERGE_STORE_ACTION = \"NEW_TAB_INITIAL_STATE\";\nexport const OUTGOING_MESSAGE_NAME = \"ActivityStream:ContentToMain\";\nexport const INCOMING_MESSAGE_NAME = \"ActivityStream:MainToContent\";\nexport const EARLY_QUEUED_ACTIONS = [at.SAVE_SESSION_PERF_DATA, at.PAGE_PRERENDERED];\n\n/**\n * A higher-order function which returns a reducer that, on MERGE_STORE action,\n * will return the action.data object merged into the previous state.\n *\n * For all other actions, it merely calls mainReducer.\n *\n * Because we want this to merge the entire state object, it's written as a\n * higher order function which takes the main reducer (itself often a call to\n * combineReducers) as a parameter.\n *\n * @param  {function} mainReducer reducer to call if action != MERGE_STORE_ACTION\n * @return {function}             a reducer that, on MERGE_STORE_ACTION action,\n *                                will return the action.data object merged\n *                                into the previous state, and the result\n *                                of calling mainReducer otherwise.\n */\nfunction mergeStateReducer(mainReducer) {\n  return (prevState, action) => {\n    if (action.type === MERGE_STORE_ACTION) {\n      return Object.assign({}, prevState, action.data);\n    }\n\n    return mainReducer(prevState, action);\n  };\n}\n\n/**\n * messageMiddleware - Middleware that looks for SentToMain type actions, and sends them if necessary\n */\nconst messageMiddleware = store => next => action => {\n  const skipLocal = action.meta && action.meta.skipLocal;\n  if (au.isSendToMain(action)) {\n    sendAsyncMessage(OUTGOING_MESSAGE_NAME, action);\n  }\n  if (!skipLocal) {\n    next(action);\n  }\n};\n\nexport const rehydrationMiddleware = store => next => action => {\n  if (store._didRehydrate) {\n    return next(action);\n  }\n\n  const isMergeStoreAction = action.type === MERGE_STORE_ACTION;\n  const isRehydrationRequest = action.type === at.NEW_TAB_STATE_REQUEST;\n\n  if (isRehydrationRequest) {\n    store._didRequestInitialState = true;\n    return next(action);\n  }\n\n  if (isMergeStoreAction) {\n    store._didRehydrate = true;\n    return next(action);\n  }\n\n  // If init happened after our request was made, we need to re-request\n  if (store._didRequestInitialState && action.type === at.INIT) {\n    return next(ac.AlsoToMain({type: at.NEW_TAB_STATE_REQUEST}));\n  }\n\n  if (au.isBroadcastToContent(action) || au.isSendToOneContent(action) || au.isSendToPreloaded(action)) {\n    // Note that actions received before didRehydrate will not be dispatched\n    // because this could negatively affect preloading and the the state\n    // will be replaced by rehydration anyway.\n    return null;\n  }\n\n  return next(action);\n};\n\n/**\n * This middleware queues up all the EARLY_QUEUED_ACTIONS until it receives\n * the first action from main. This is useful for those actions for main which\n * require higher reliability, i.e. the action will not be lost in the case\n * that it gets sent before the main is ready to receive it. Conversely, any\n * actions allowed early are accepted to be ignorable or re-sendable.\n */\nexport const queueEarlyMessageMiddleware = store => next => action => {\n  if (store._receivedFromMain) {\n    next(action);\n  } else if (au.isFromMain(action)) {\n    next(action);\n    store._receivedFromMain = true;\n    // Sending out all the early actions as main is ready now\n    if (store._earlyActionQueue) {\n      store._earlyActionQueue.forEach(next);\n      store._earlyActionQueue = [];\n    }\n  } else if (EARLY_QUEUED_ACTIONS.includes(action.type)) {\n    store._earlyActionQueue = store._earlyActionQueue || [];\n    store._earlyActionQueue.push(action);\n  } else {\n    // Let any other type of action go through\n    next(action);\n  }\n};\n\n/**\n * initStore - Create a store and listen for incoming actions\n *\n * @param  {object} reducers An object containing Redux reducers\n * @param  {object} intialState (optional) The initial state of the store, if desired\n * @return {object}          A redux store\n */\nexport function initStore(reducers, initialState) {\n  const store = createStore(\n    mergeStateReducer(combineReducers(reducers)),\n    initialState,\n    global.addMessageListener && applyMiddleware(rehydrationMiddleware, queueEarlyMessageMiddleware, messageMiddleware)\n  );\n\n  store._didRehydrate = false;\n  store._didRequestInitialState = false;\n\n  if (global.addMessageListener) {\n    global.addMessageListener(INCOMING_MESSAGE_NAME, msg => {\n      try {\n        store.dispatch(msg.data);\n      } catch (ex) {\n        console.error(\"Content msg:\", msg, \"Dispatch error: \", ex); // eslint-disable-line no-console\n        dump(`Content msg: ${JSON.stringify(msg)}\\nDispatch error: ${ex}\\n${ex.stack}`);\n      }\n    });\n  }\n\n  return store;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./system-addon/content-src/lib/init-store.js","module.exports = Redux;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"Redux\"\n// module id = 24\n// module chunks = 0","module.exports = ReactDOM;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"ReactDOM\"\n// module id = 25\n// module chunks = 0"],"sourceRoot":""}